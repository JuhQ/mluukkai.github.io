<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>viikko 1</title>
  <meta name="description" content="">

  <link rel="stylesheet" href="/assets/main.css">
  <link rel="canonical" href="http://localhost:4000/viikko1/">
  <link rel="alternate" type="application/rss+xml" title="Full stack -websovelluskehitys" href="/feed.xml">
  
  
</head>


  <body>

    <header class="site-header" role="banner">

  <div class="wrapper">
    
    
    <a class="site-title" href="/">Full stack -websovelluskehitys</a>
  
    
      <nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
              <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
              <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger">
          
            
            
          
            
            
            <a class="page-link" href="/about/">About</a>
            
          
            
            
          
            
            
            <a class="page-link" href="/viikko1/">viikko 1</a>
            
          
            
            
          
            
            
          
        </div>
      </nav>
    
  </div>
</header>


    <main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post">

  <header class="post-header">
    <h1 class="post-title">viikko 1</h1>
  </header>

  <div class="post-content">
    <h2 id="yleistä">yleistä</h2>

<p>Kurssilla tutustutaan javascriptilla tapahtuvaan moderniin websovelluskehitykseen. Pääpaino on React-kirjaston avulla toteutettavissa single page -sovelluksissa, ja niitä tukevissa node.js-kirjastolla toteutetuissa REST-rajapinnoissa.</p>

<p>Kurssilla käsitellään myös sovellusten testaamista, konfigurointia ja suoritusympäristöjen hallintaa sekä NoSQL-tietokantoja.</p>

<p>Osallistujilta edellytetään vahvaa ohjelmointiruutiinia, web-ohjelmoinnin ja tietokantojen perustuntemusta (esim. opintojakson Tietokantasovellus-suoritusta) sekä valmiutta omatoimiseen tiedonhakuun.</p>

<p>Kurssille osallistuminen ei edellytä käsiteltyjen tekniikoiden tai javascript-kielen hallintaa.</p>

<h2 id="alkutoimet">alkutoimet</h2>

<p>node, git, chrome, …</p>

<h2 id="viikon-1-oppimistavoitteet">viikon 1 oppimistavoitteet</h2>

<ul>
  <li>…</li>
</ul>

<h2 id="web-sovelluksen-toimintaperiaatteita">web-sovelluksen toimintaperiaatteita</h2>

<p>Tällä kurssilla suositellaan Chrome-selaimen käyttöä sillä se tarjoaa parhaan välineistön web-sovelluskehitystä ajatellen.</p>

<p>Erään Chromessa olevan, hieman sovelluskehitystä haittaavan bugin takia kaikkein suositeltavinta on Chromen ns.
<a href="https://www.google.fi/chrome/browser/canary.html">canary-version</a> käyttäminen.</p>

<p>Avataan selaimella osoitteessa <a href="https://fullstack-exampleapp.herokuapp.com/">https://fullstack-exampleapp.herokuapp.com/</a> oleva esimerkkisovellus.</p>

<div class="important">
<h3>Web-sovelluskehityksen sääntö numero yksi</h3>  
Pidä selaimen developer-konsoli koko ajan auki
</div>

<p>Konsoli avautuu macilla painamalla yhtä aikaa <em>alt</em> <em>com</em> ja <em>i</em>. Ennen kun jatkat eteenpäin, selvitä miten saat koneellasi konsolin auki ja muista pitää se auki <em>aina</em> kun teet web-sovelluksia.</p>

<p>Konsoli näyttää seuraavalta:
<img src="http://localhost:4000/assets/1/1.png" alt="" /></p>

<p>Varmista, että välilehti <em>Network</em> on avattuna ja aktivoi valinta <em>Disable cache</em> kuten kuvassa on tehty.</p>

<h3 id="http-get">HTTP GET</h3>

<p>Selain ja web-palvelin kommunikoivat keskenään <a href="https://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol">HTTP</a>-protokollaa käyttäen ja avoinna oleva konsolin Network-tabi kertoo miten selain ja palvelin kommunikoivat.</p>

<p>Kun nyt reloadaat selaimen, kertoo konsoli, että tapahtuu kaksi asiaa: selain hakee web-palvelimelta sivun <em>fullstack-exampleapp.herokuapp.com/</em> sisällön ja lataa kuvan <em>kuva.png</em>.</p>

<p><img src="http://localhost:4000/assets/1/2.png" alt="" /></p>

<p>Klikkaamalla näistä ensimmäistä, paljastuu tarkempaa tietoa siitä mistä on kyse:</p>

<p><img src="http://localhost:4000/assets/1/3.png" alt="" /></p>

<p>Ylimmästä osasta ‘General’ selviää, että selain teki <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Methods/GET">GET</a>-metodilla pyynnön osoitteeseen <em>https://fullstack-exampleapp.herokuapp.com/</em> ja että pyyntö oli onnistunut, sillä pyyntöön saatiin vastaus, jonka <a href="https://en.wikipedia.org/wiki/List_of_HTTP_status_codes">Status code</a> on 200.</p>

<p>Pyyntöön ja palvelimen lähettämään vastaukseen liitty erinäinen määrä otsakkeita eli <a href="https://en.wikipedia.org/wiki/List_of_HTTP_header_fields">headereita</a>.</p>

<p><img src="http://localhost:4000/assets/1/4.png" alt="" /></p>

<p>Ylempänä oleva <em>response headers</em> kertoo mm. vastauksen koon tavuina ja vastaushetken sekä sen. Tärkeä <em>Content-Type</em> headeri kertoo että vastaus on utf-8 muodossa oleva teksti-tiedosto, jonka sisältö on muotoiltu HTML:llä. Näin selain tietää että sen, että kyseessä on normaali <a href="https://en.wikipedia.org/wiki/HTML">HTML</a>-sivu joka tulee renderöidä käyttäjän selaimeen.</p>

<p>Välilehti <em>Preview</em> näyttää miltä pyyntöön vastauksena lähetetty data näyttää. Kyseessä on siis normaali HTML-sivu, jonka <em>body</em>-osassa määritellään selaimessa näytettävän sivun rakenne:</p>

<p><img src="http://localhost:4000/assets/1/5.png" alt="" /></p>

<p>Sivu sisältää <em>div</em>-elementin, jonka sisällä on otsikko sekä tieto luotujen muistiinpanojen määrästä, linkki sivulle <em>muistiinpanot</em> ja <em>img</em>-tagi.</p>

<p>img-tagin ansiosta selain tekee siis HTTP-pyynnön, jonka avulla se hakee kuvan palvelimelta. Pyynnön tiedot näyttävät seuraavalta:</p>

<p><img src="http://localhost:4000/assets/1/6.png" alt="" /></p>

<p>eli pyyntö on tehty osoitteeseen <em>https://fullstack-exampleapp.herokuapp.com/kuva.png</em> ja se on tyypiltään HTTP GET. Vastaukseen liittyvät headerit kertovat että vastauksen koko on 89350 tavua ja vastauksen Content-type on <em>image/png</em>, eli kyseessä on png-tyyppinen kuva. Tämän tiedon ansiosta selain tietää miten kuva on sijoitettava HTML-sivulle.</p>

<h3 id="perinteinen-web-sovellus">perinteinen web-sovellus</h3>

<p>Esimerkkisovelluksen pääsivu toimii perinteisen web-sovelluksen tapaan. Mentäessä sivulle, selain hakee palvelimelta sivun muotoilun ja tekstuaalisen sisällön määrittelevän HTML-dokumentin.</p>

<p>Palvelin on muodostanut dokumentin jollain tavalla. Dokumentti voi olla <em>staattista sisältöä</em> eli palvelimen hakemistossa oleva tekstitiedosto. Dokumentti voi myös olla <em>dynaaminen</em>, eli palvelin voi muodostaa HTML-dokumentit esim. tietokannassa olevien tietojen perusteella. Esimerkkisovelluksessa sivun HTML-koodi on muodostettu dynaamisesti sillä se sisältää tiedon luotujen muistiinpanojen lukumäärästä.</p>

<p>Etusivun muodostama koodi näyttää seuraavalta:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">getFronPageHtml</span> <span class="o">=</span> <span class="p">(</span><span class="nx">noteCount</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span><span class="p">(</span><span class="s2">`
  &lt;!DOCTYPE html&gt;
    &lt;html&gt;
      &lt;head&gt;
      &lt;/head&gt;
      &lt;body&gt;
        &lt;div class='container'&gt;
          &lt;h1&gt;Full stack -esimerkkisovellus&lt;/h1&gt;
          &lt;p&gt;muistiinpanoja luotu </span><span class="p">${</span><span class="nx">noteCount</span><span class="p">}</span><span class="s2"> kappaletta&lt;/p&gt;
          &lt;a href='/notes'&gt;muistiinpanot&lt;/a&gt;
          &lt;img src='kuva.png' width='200' /&gt;
        &lt;/div&gt;
      &lt;/body&gt;
    &lt;/html&gt;`</span><span class="p">)</span>
<span class="p">}</span> 

<span class="nx">app</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="s1">'/'</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">page</span> <span class="o">=</span> <span class="nx">getFronPageHtml</span><span class="p">(</span><span class="nx">notes</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">page</span><span class="p">)</span>
<span class="p">})</span>
</code></pre></div></div>

<p>Koodia ei tarvitse vielä ymmärtää, mutta käytännössä HTML-sivun sisältö on talletettu ns. template stringinä muuttujaan. Etusivun dynaamisesti muuttuva osa, eli muistiinpanojen lukumäärä korvataan template stringissä sen hetkisellä konkreettisella lukuarvolla.</p>

<p>Perinteisissä websovelluksissa selain on “tyhmä”, se ainoastaan pyytää palvelimelta  HTML-muodossa olevia sisältöjä, kaikki sovelluslogiikka on palvelimessa. Palvelin voi olla tehty esim. kurssin <a href="https://courses.helsinki.fi/fi/tkt21007/119558639">Web-palvelinohjelmointi, Java</a> tapaan Springillä, kuten <a href="http://tsoha.github.io/#/johdanto#top">Tietokantasovelluksessa</a> PHP:llä. Esimerkissä on käytetty Node.js:n <a href="https://expressjs.com/">Express</a>-sovelluskehystä. Tulemme käyttämään kurssilla Node.js:ää ja Expresiä web-palvelien toteuttamiseen.</p>

<h3 id="selaimessa-suoritettava-sovelluslogiikka">selaimessa suoritettava sovelluslogiikka</h3>

<p>Pidä konsoli edelleen auki. Tyhjennä konsoloin näkymä painamalla vasemmalla olevaa ∅-symbolia.</p>

<p>Kun menet nyt muistiinpanojen sivulle, selain tekee 4 HTTP-pyyntöä:</p>

<p><img src="http://localhost:4000/assets/1/7.png" alt="" /></p>

<p>Kaikki pyynnöt ovat <em>eri tyyppisiä</em>. Ensimmäinen pyyntö on tyypiltään <em>document</em>
kyseessä on sivun HTML-koodi, joka näyttää seuraavalta:</p>

<p><img src="http://localhost:4000/assets/1/8.png" alt="" /></p>

<p>Kun vertaamme, selaimen näyttämää sivua ja pyynnön palauttamaa HTML-koodia, huomaamme, että koodi ei sisällä ollenkaan kolme muistiinpanoa sisältävää listaa.</p>

<p>HTML-koodin <em>head</em> osio sisältää <em>script</em>-tagin, jonka ansiosta selain lataa <em>main.js</em>-nimisen javascript-tiedoston palvelimelta.</p>

<p>Ladattu javascript-koodi näyttää seuraavalta</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">xhttp</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">()</span>
  
<span class="nx">xhttp</span><span class="p">.</span><span class="nx">onreadystatechange</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">readyState</span> <span class="o">==</span> <span class="mi">4</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">status</span> <span class="o">==</span> <span class="mi">200</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">responseText</span><span class="p">)</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>

    <span class="kd">var</span> <span class="nx">ul</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">'ul'</span><span class="p">)</span>
    <span class="nx">ul</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s1">'class'</span><span class="p">,</span> <span class="s1">'notes'</span><span class="p">)</span>

    <span class="nx">data</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">note</span><span class="p">){</span>
      <span class="kd">var</span> <span class="nx">li</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">'li'</span><span class="p">)</span>
      
      <span class="nx">ul</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">li</span><span class="p">);</span>
      <span class="nx">li</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">createTextNode</span><span class="p">(</span><span class="nx">note</span><span class="p">.</span><span class="nx">content</span><span class="p">))</span>
    <span class="p">})</span>

    <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">"notes"</span><span class="p">).</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">ul</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nx">xhttp</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s2">"GET"</span><span class="p">,</span> <span class="s2">"/data.json"</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span>
<span class="nx">xhttp</span><span class="p">.</span><span class="nx">send</span><span class="p">()</span>
</code></pre></div></div>

<p>Koodin yksityiskohdat eivät ole tässä vaiheessa vielä oleellisia.</p>

<p>Ladattuaan <em>script</em>-tagin sisältämän javascriptin selain suorittaa koodin.</p>

<p>Kaksi viimeistä riviä määrittelevät, että selain tekee GET-tyyppisen HTTP-pyynnön osoitteeseen palvelimen osoitteeseen <em>/data.json</em>:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">xhttp</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s2">"GET"</span><span class="p">,</span> <span class="s2">"/data.json"</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span>
<span class="nx">xhttp</span><span class="p">.</span><span class="nx">send</span><span class="p">()</span>
</code></pre></div></div>

<p>Kyseessä on neljäs Network tabin näyttämistä selaimen tekemistä pyynnöistä.</p>

<p>Voimme kokeilla mennä osoitteeseen <a href="https://fullstack-exampleapp.herokuapp.com/data.json">https://fullstack-exampleapp.herokuapp.com/data.json</a> suoraan selaimella:</p>

<p><img src="http://localhost:4000/assets/1/9.png" alt="" /></p>

<p>Osoitteesta löytyvät muistiinpanot <a href="https://en.wikipedia.org/wiki/JSON">JSON</a>-muotoisena “raakadatana”. Oletusarvoisesti selain ei osaa näyttää JSON-dataa kovin hyvin, mutta on olemassa lukuisia plugineja jotka hoitavat muotoilun. Asenna nyt chromeen esim. <a href="https://chrome.google.com/webstore/detail/jsonview/chklaanhfefbnpoihckbnefhakgolnmc">JSONView</a>
ja lataa sivu uudelleen. Data on nyt miellyttävämmin muotoiltua:</p>

<p><img src="http://localhost:4000/assets/1/10.png" alt="" /></p>

<p>Ylläoleva javascript-koodi siis lataa muistiinpanot sisältävän JSON-muotoisen datan ja 
muodostaa datan avulla selaimeen “bulletlistan” muistiinpanojen sisällöstä:</p>

<p>Tämän saa aikaan seuraava koodi:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="kd">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">responseText</span><span class="p">)</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>

    <span class="kd">var</span> <span class="nx">ul</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">'ul'</span><span class="p">)</span>
    <span class="nx">ul</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s1">'class'</span><span class="p">,</span> <span class="s1">'notes'</span><span class="p">)</span>

    <span class="nx">data</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">note</span><span class="p">){</span>
      <span class="kd">var</span> <span class="nx">li</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">'li'</span><span class="p">)</span>
      
      <span class="nx">ul</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">li</span><span class="p">);</span>
      <span class="nx">li</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">createTextNode</span><span class="p">(</span><span class="nx">note</span><span class="p">.</span><span class="nx">content</span><span class="p">))</span>
    <span class="p">})</span>

    <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">"notes"</span><span class="p">).</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">ul</span><span class="p">)</span>
</code></pre></div></div>

<p>Koodi muodostaa ensin järjestämätöntä listaa edustavan <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/ul">ul</a>-tagin:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="kd">var</span> <span class="nx">ul</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">'ul'</span><span class="p">)</span>
    <span class="nx">ul</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s1">'class'</span><span class="p">,</span> <span class="s1">'notes'</span><span class="p">)</span>
</code></pre></div></div>

<p>ja lisää ul:n sisään yhden <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/li">li</a>-elementin kutakin muistiinpanoa kohti. Ainoastaan muistiinpanon <em>content</em>-kenttä tulee li-elementin sisällöksi, raakadatassa olevia aikaleimoja ei käytetä mihinkään.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="nx">data</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">note</span><span class="p">){</span>
      <span class="kd">var</span> <span class="nx">li</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">'li'</span><span class="p">)</span>
      
      <span class="nx">ul</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">li</span><span class="p">);</span>
      <span class="nx">li</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">createTextNode</span><span class="p">(</span><span class="nx">note</span><span class="p">.</span><span class="nx">content</span><span class="p">))</span>
    <span class="p">})</span>
</code></pre></div></div>

<p>Avaa nyt konsolin <em>Console</em>-välilehti:</p>

<p><img src="http://localhost:4000/assets/1/11.png" alt="" /></p>

<p>Painamalla rivin alussa olevaa kolmiota saat laajennettua konsolissa olevan rivin:</p>

<p><img src="http://localhost:4000/assets/1/12.png" alt="" /></p>

<p>Konsoliin ilmestynyt tulostus johtuu siitä, että koodiin oli lisätty komento <em>console.log</em>:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="kd">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">responseText</span><span class="p">)</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>
</code></pre></div></div>

<p>eli vastaanotettuaan datan palvelimelta, koodi tulostaa datan konsoliin.</p>

<p>Tulet tarvitsemaan komentoa <em>console.log</em> kurssilla todella monta kertaa…</p>

<h3 id="tapahtumankäsittelijä-ja-takaisinkutsu">tapahtumankäsittelijä ja takaisinkutsu</h3>

<p>Koodin rakenne on hieman erikoinen:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">xhttp</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">()</span>
  
<span class="nx">xhttp</span><span class="p">.</span><span class="nx">onreadystatechange</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="c1">// koodi, joka käsittelee palvelimen vastauksen</span>
<span class="p">}</span>

<span class="nx">xhttp</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s2">"GET"</span><span class="p">,</span> <span class="s2">"/data.json"</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span>
<span class="nx">xhttp</span><span class="p">.</span><span class="nx">send</span><span class="p">()</span>
</code></pre></div></div>

<p>eli palvelimelle tehtävä pyyntö suoritetaan vasta viimeisellä rivillä. Palvelimen vastauksen käsittelyn määrittelevä koodi on kirjoitettu jo aiemmin. Mistä on kyse?</p>

<p>Rivillä</p>
<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">xhttp</span><span class="p">.</span><span class="nx">onreadystatechange</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</code></pre></div></div>

<p>kyselyn tekevään <code>xhttp</code>-olioon määritellään <em>tapahtumankäsittelijä</em> (event handler) tilanteelle <em>onreadystatechange</em>. Kun kyselyn tekevän olion tila muuttuu, kutsuu selain tapahtumankäsittelijänä olevaa funktiota. Funktion koodi tarkastaa, että <a href="https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/readyState">readyState</a>:n arvo on 4 (joka kuvaa tilannetta <em>The operation is complete</em>) ja, että vastauksen HTTP-statuskoodi on onnistumisesta kertova 200.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">xhttp</span><span class="p">.</span><span class="nx">onreadystatechange</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">readyState</span> <span class="o">==</span> <span class="mi">4</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">status</span> <span class="o">==</span> <span class="mi">200</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// koodi, joka käsittelee palvelimen vastauksen</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Tapahtumankäsittelijöihin liittyvä mekanismi koodin suorittamiseen on javascriptissä erittäin yleistä. Tapahtumankäsittelijöinä olevia javascript-funktioita kutsutaan <a href="https://developer.mozilla.org/en-US/docs/Glossary/Callback_function">call back</a> eli takaisinkutsufunktioiksi sillä sovelluksen koodi ei kutsu niitä itse vaan suoritusympäristö, eli web-selain suorittaa funktion kutsumisen sopivana ajankohtana, eli kyseisen <em>tapahtuman</em> tapahduttua.</p>

<h3 id="document-object-model-eli-dom">Document Object Model eli DOM</h3>

<p>Voimme ajatella, että HTML-sivut muodostavat implisiittisen puurakenteen</p>

<pre>
html
  head
    link
    script
  body
    div
      h1
      div  
        ul
          li
          li
          li
      form
        input
        input
</pre>

<p>Sama puumaisuus on nähtävissä konsolin välilehdellä <em>Elements</em></p>

<p><img src="http://localhost:4000/assets/1/13.png" alt="" /></p>

<p>Selainten toiminta perustuu ideaan esittää html-elementit puurakenteena.</p>

<p>Document Object Model eli <a href="https://en.wikipedia.org/wiki/Document_Object_Model">DOM</a> on ohjelmointirajapinta eli <em>API</em>, jonka mahdollistaa selaimessa esitettävien web-sivujen muokkaamisen ohjelmallisesti.</p>

<p>Edellisessä luvussa esittelemämme javascript-koodi käytti nimenomaan DOM:ia lisätäkseen sivulle  muistiinpanojen listan.</p>

<p>HTML-dokumentin</p>

<p><img src="http://localhost:4000/assets/1/13b.png" alt="" /></p>

<p>DOM:a havainnollistava kuva Wikipedian sivulta:</p>

<p><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/5/5a/DOM-model.svg/428px-DOM-model.svg.png" alt="" /></p>

<h3 id="document-olio">document-olio</h3>

<p>HTML-dokumenttia esittävän DOM-puun ylimpänä solmuna on olio nimeltään <em>document</em>. Olioon pääsee käsiksi Console-välilehdeltä:</p>

<p><img src="http://localhost:4000/assets/1/14.png" alt="" /></p>

<p>Voimme suorittaa konsolista käsin DOM:in avulla erilaisia operaatioita selaimessa näytettävälle web-sivulle.</p>

<p>Lisätään nyt sivulle uusi muistiinpano suoraan konsolista.</p>

<p>Haetaan ensin sivulta muistiinpanojen lista, eli sivun ul-elementeistä ensimmäinen:</p>
<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">lista</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s1">'ul'</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</code></pre></div></div>

<p>luodaan uusi li-elementti ja lisätään sille sopiva tekstisisältö:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">uusi</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">'li'</span><span class="p">)</span>
<span class="nx">uusi</span><span class="p">.</span><span class="nx">textContent</span> <span class="o">=</span> <span class="s1">'Sivun manipulointi konsolista on helppoa'</span>
</code></pre></div></div>

<p>liitetään li-elementti listalle:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">lista</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">uusi</span><span class="p">)</span>
</code></pre></div></div>

<p><img src="http://localhost:4000/assets/1/15.png" alt="" /></p>

<p>Vaikka selaimen näyttävä sivu päivittyy, ei muutos ole lopullinen. Jos sivu uudelleenladataan, katoaa uusi muistiinpano sillä muutos ei mennyt palvelimelle asti. Selaimen lataama javascript luo muistiinpanojen listan aina palvelimelta osoitteesta <a href="https://fullstack-exampleapp.herokuapp.com/data.json">https://fullstack-exampleapp.herokuapp.com/data.json</a>  haettavan JSON-muotoisen raakadatan perusteella.</p>

<h3 id="css">CSS</h3>

<p>Muistiinpanojen sivun HTML-koodin <em>head</em>-osio sisältää <em>link</em>-tagin, joka määrittelee, että selaimen tulee ladata pavelimelta osoitteesta <a href="https://fullstack-exampleapp.herokuapp.com/main.css">main.css</a> sivulla käytettävä <a href="https://developer.mozilla.org/en-US/docs/Web/CSS">css</a>-tyylitiedosto</p>

<p>Cascading Style Sheets eli CSS on kieli, jonka avulla web-sovellusten ulkoasu määritellään.</p>

<p>Ladattu css-tiedosto näyttää seuraavalta:</p>

<div class="language-css highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">.container</span> <span class="p">{</span>
  <span class="nl">padding</span><span class="p">:</span> <span class="m">10px</span><span class="p">;</span>
  <span class="nl">border</span><span class="p">:</span> <span class="m">1px</span> <span class="nb">solid</span>
<span class="p">}</span>

<span class="nc">.notes</span> <span class="p">{</span>
  <span class="nl">color</span><span class="p">:</span> <span class="no">blue</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Tiedosto määrittelee kaksi <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/Class_selectors">luokkaselektoria</a>, joiden avulla valitaan tietty sivun alue ja määritellään alueelle sovellettavat tyylisäännöt.</p>

<p>Luokkaselekotori alkaa aina pisteellä ja sisältää luokan nimen.</p>

<p>Luokat ovat <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Global_attributes/class">attribuuteja</a> joita voidaan liittää HTML-elementeille.</p>

<p>Konsolin <em>Elements</em>-välilehti mahdollistaa class-attribuuttien tarkastelun:</p>

<p><img src="http://localhost:4000/assets/1/16.png" alt="" /></p>

<p>sovelluksen uloimmalle <em>div</em>-elementille on siis liitetty luokka <em>container</em>. Muistiinpanojen listan sisältävä <em>ul</em>-elementin sisällä oleva lista sisältää luokan <em>notes</em>.</p>

<p>CSS-säännön avulla on määritelty, että <em>container</em>-luokan sisältävä elementti ympäröidään yhden pikselin paksuisella <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/border">border</a>:illa. Elementille asetetaan myös 10 pikselin <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/padding">padding</a>, jonka ansiosta elementin sisältön ja elementin ulkorajan väliin jätetään hieman tilaa.</p>

<p>Toinen määritelty CSS-sääntö asettaa muistiinpanojen kirjainten värin siniseksi.</p>

<p>HTML-elementeillä on muitekin attribuutteja kuin luokkia. Muistiinpanot sisältävä <em>div</em>-elementti sisältää <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Global_attributes/id">id</a>-attribuutin. Javascript-koodi hyödyntää attribuuttia elementin etsimiseen.</p>

<p>Konsolin <em>Elements</em>-välilehdellä on mahdollista manipuloida elementtien tyylejä:
<img src="http://localhost:4000/assets/1/17.png" alt="" /></p>

<p>Tehdyt muutokset eivät luonnollisestikaan jää voimaan kun selaimen sivu uudelleenladataan, eli jos muutokset halutaan pysyviksi, tulee ne konsolissa tehtävien kokeilujen jälkeen tallettaa palvelimella olevaan tyylitiedostoon.</p>

<h3 id="lomake-ja-http-post">lomake ja HTTP POST</h3>

<p>Tutkitaan seuraavaksi sitä, miten uusien muistiinpanojen luominen tapahtuu. Tätä varten muistiinpanojen sivu sisältää lomakkeen eli <a href="https://developer.mozilla.org/en-US/docs/Learn/HTML/Forms/Your_first_HTML_form">formin</a>.</p>

<p><img src="http://localhost:4000/assets/1/18.png" alt="" /></p>

<p>Kun lomakkeen painiketta painetaan, lähettää selain lomakkeelle syötetyn datan palvelimele. Avataan <em>Network</em>-tabi ja katsotaan miltä lomakkeen lähettäminen näyttää:</p>

<p><img src="http://localhost:4000/assets/1/19.png" alt="" /></p>

<p>Lomakkeen lähettäminen aiheuttaa yllättäen yhteensä viisi HTTP-pyyntöä. Näistä ensimmäinen vastaa lomakkeen lähetystapahtumaa. Tarkennetaan siihen:</p>

<p><img src="http://localhost:4000/assets/1/20.png" alt="" /></p>

<p>Kyseessä on siis HTTP POST -pyyntö ja se on tehty palvelimen osoitteeseen <em>new_note</em>. Palvelin vastaa pyyntöön HTTP-statuskoodilla 302. Kyseessä on ns. uudelleenohjauspyyntö, minkä avulla palvelin kehoittaa selainta tekemään automaattisesti uuden HTTP GET -pyynnön headerin <em>Location</em> kertomaan paikkaan, eli osoitteeseen <em>notes</em>.</p>

<p>Selain siis lataa uudelleen muistiinpanojen sivun. Sivunlataus saa aikaan myös kolme muuta HTTP-pyyntöä: tyylitiedostojen, javascriptin ja muistiinpanojen raakadatan lataamisen.</p>

<p>Network-välilehti näyttää myös lomakkeen mukana lähetetyn datan:</p>

<p><img src="http://localhost:4000/assets/1/21.png" alt="" /></p>

<p>Jos käytät normaalia Chrome-selainta, ei konsoli ehkä näytä lähetettävää dataa. Kyseessä on eräissä Chromen versioissa oleva <a href="https://bugs.chromium.org/p/chromium/issues/detail?id=766715">bugi</a>. Bugi on korjattu Chromen <a href="https://www.google.fi/chrome/browser/canary.html">canary-versiossa</a> ja tulee korjaantumaan aikanaan myös “normaaliin” versioon.</p>

<p>Lomakkeen lähettäminen tapahtuu HTTP POST -pyyntönä ja osoitteeseen <em>new_note</em> form-tagiin määriteltyjen attribuuttien <em>action</em> ja <em>method</em> ansiosta:</p>

<p><img src="http://localhost:4000/assets/1/22.png" alt="" /></p>

<p>POST-pyynnöstä huolehtiva palvelimen koodi on yksinkertainen:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">app</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">'/new_note'</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">notes</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span> <span class="p">{</span> 
    <span class="na">content</span><span class="p">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">note</span><span class="p">,</span>
    <span class="na">date</span><span class="p">:</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">()</span>
  <span class="p">})</span>

  <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">redirect</span><span class="p">(</span><span class="s1">'/notes'</span><span class="p">)</span>
<span class="p">})</span>
</code></pre></div></div>

<p>POST-pyyntöihin liitettävä data lähetetään pyynnön mukana “runkona” eli <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Methods/POST">bodynä</a>. Palvelin saa POST-pyynnön datan pyytämällä sitä pyyntöä vastaavan olion <em>req</em> kentästä <em>req.body</em>.</p>

<p>Tekstikenttään kirjoitettu data on avaimen <em>notes</em> alla, eli palvelin viittaa siihen <em>req.body.note</em>.</p>

<p>Palvelin luo uutta muistiinpano vastaavan olion ja laittaa sen muistiinpanot sisältävään taulukkoon:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nx">notes</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span> <span class="p">{</span> 
    <span class="na">content</span><span class="p">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">note</span><span class="p">,</span>
    <span class="na">date</span><span class="p">:</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">()</span>
  <span class="p">})</span>
</code></pre></div></div>

<p>Muistiinpano-olioilla on siis kaksi kenttää, varsinaisen sisällön kuvaava <em>content</em> ja luomishetken kertova <em>data</em>.</p>

<p>Palvelin ei talleta muistiinpanoja tietokantaan, joten uudet muistiinpanot katoavat aina Herokun uudelleenkäynnistäessä palvelun.</p>

<h2 id="single-page-app">single page app</h2>

<p>Esimerkkisovelluksemme pääsivu toimii perinteisten web-sivujen tapaan, kaikki sovelluslogiikka on palvelimella, selain ainoastaan renderöi palvelimen lähettämää HTML-koodia.</p>

<p>Muistiinpanoista huolehtivassa sivussa osa sovelluslogiikasta, eli olemassaolevien muistiinpanojen HTML-koodin generointi on siirretty selaimen vastuulle. Selain hoita tehtävän suorittamalla palvelimelta lataamansa Javascript-koodin. Selaimella suoritettava koodi hakee muistiinpanot palvelimelta JSON-muotoisena raakadatana.</p>

<p>Viime aikoina on noussut esiin tyyli tehdä web-sovelukset käyttäen <a href="https://en.wikipedia.org/wiki/Single-page_application">Single-page application</a> (SPA) -tyyliä, missä sovelluksille ei enää tehdä esimerkkisovelluksemme tapaan erillisiä sivuja, palvelimen sille lähettämiä sivuja, vaan sovellus koostuu ainoastaan yhdestä palvelimen lähettämästä HTML-sivusta, jonka sisältöä manipuloidaan selaimessa suoritettavalla Javascriptillä.</p>

<p>Sovelluksemme muistiinpanosivu muistuttaa jo hiukan SPA-tyylistä sovellusta, sitä se ei kuitenkaan vielä ole, sillä vaikka muistiinpanojen renderöintilogiikka on toteutettu selaimessa, käyttää sivu vielä perinteista mekanisimia uusien muistiinpanojen luomiseen. Eli se lähettää uuden muistiinpanon tiedot ja palvelin pyytää <em>uudelleenohjauksen</em> avulla selainta lataamaan muistiinpanojen sivun uudelleen.</p>

<p>Osoitteesta <a href="https://fullstack-exampleapp.herokuapp.com/spa">https://fullstack-exampleapp.herokuapp.com/spa</a> löytyy sovelluksen single page app -versio.</p>

<p>Sovellus näyttää ensivilkaisulta täsmälleen samalta kuin edellinen versio.</p>

<p>HTML-koodi on lähes samanlainen, erona on ladattava javascript-tiedosto ja pieni muutos form-tagin määrittelyssä:</p>

<p><img src="http://localhost:4000/assets/1/23.png" alt="" /></p>

<p>Avaa nyt ‘Network’-tabi ja tyhjennä se  ∅-symbolilla. Kun luot uuden muistiinpanon, huomaat, että selain lähettää ainoastaan yhden pyynnön palvelimelle:</p>

<p><img src="http://localhost:4000/assets/1/24.png" alt="" /></p>

<p>Pyyntö on tyypiltään POST ja se sisältää JSON-muodossa olevan uuden muistiinpanon, johon kuuluu sekä sisältö, että aikaleima:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span>
  <span class="nl">content</span><span class="p">:</span> <span class="s2">"single page app ei tee turhia sivun latauksia"</span><span class="p">,</span> 
  <span class="nx">date</span><span class="p">:</span> <span class="s2">"2017-12-11T10:51:29.025Z"</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Pyyntöön liitetty headeri <em>Content-Type</em> kertoo palvelimelle, että pyynnön mukana tuleva data on JSON-muotoista:</p>

<p><img src="http://localhost:4000/assets/1/25.png" alt="" /></p>

<p>Ilman headeria, palvelin ei osaisi parsia pyynnön mukana tulevaa dataa oiken.</p>

<p>Palvelin vastaa kyselyyn statuskoodilla 201 <a href="https://httpstatuses.com/201">created</a>. Tällä kertaa palvelin ei pyydä uudelleenohjausta kuten aiemmassa versiossamme. Selain pysyy samalla sivulla ja muita HTTP-pyyntöjä ei suoriteta.</p>

<p>Ohjelman spa-versiossa lomakkeen tietoja ei lähetetä selaimen “normaalin” lomakkeiden lähetysmekanismin avulla, lähettämisen hoitaa selaimen lataamassa Javascript-tiedostossa määritelty koodi. Katsotaan hieman koodia vaikka yksityiskohdista ei tarvitse nytkään välittää liikaa.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kd">var</span> <span class="nx">form</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">"notes_form"</span><span class="p">)</span>
  <span class="nx">form</span><span class="p">.</span><span class="nx">onsubmit</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">()</span>

    <span class="kd">var</span> <span class="nx">note</span> <span class="o">=</span> <span class="p">{</span>
      <span class="na">content</span><span class="p">:</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">elements</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">value</span><span class="p">,</span>
      <span class="na">date</span><span class="p">:</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="nx">notes</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">note</span><span class="p">)</span>
    <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">elements</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">value</span> <span class="o">=</span> <span class="s2">""</span>
    <span class="nx">redrawNotes</span><span class="p">()</span>
    <span class="nx">sendToServer</span><span class="p">(</span><span class="nx">note</span><span class="p">)</span>
  <span class="p">}</span>
</code></pre></div></div>

<p>Koodi hakee sivulta lomake-elementin ja rekisteröi sille tapahtumankäsittelijän hoitamaan tilanteen, missä lomake “submitoidaan”, eli lähetetään. Tapahtumankäsittelijä 
kutsuu heti metodia <code>e.preventDefault()</code> jolla se estää lomakkeen lähetyksen oletusarvoisen toiminnan. Oletusarvoinen toiminta aiheuttaisi lomakkeen lähettämisen ja sivun uuden lataamisen, sitä emme spa-sovelluksissa halua tapahtuvatn.</p>

<p>Tämän jälkeen se luo muistiinpanon, lisää sen muistiinpanojen listalle komennolla <code>notes.push(note)</code>, piirää ruudun sisällön eli muistiinpanojen listan uudelleen ja lähettää uuden muistiinpanon palvelimelle.</p>

<p>Palvelimelle muistiinpanon lähettävä koodi seuraavassa:</p>
<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">sendToServer</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">note</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">xhttpForPost</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">()</span>
  <span class="c1">// ...</span>

  <span class="nx">xhttpForPost</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s2">"POST"</span><span class="p">,</span> <span class="s1">'/new_note_spa'</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span>
  <span class="nx">xhttpForPost</span><span class="p">.</span><span class="nx">setRequestHeader</span><span class="p">(</span><span class="s2">"Content-type"</span><span class="p">,</span> <span class="s2">"application/json"</span><span class="p">)</span>
  <span class="nx">xhttpForPost</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">note</span><span class="p">));</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Koodissa siis määritellään, että kyse on HTTP POST -pyynnöstä, määritellään headerin <em>Content-type</em> avulla lähetettävän datan tyypiksi JSON, ja lähetetään data JSON-merkkijonona.</p>

<p>Sovelluksen koodi on nähtävissä osoitteessa <a href="https://github.com/mluukkai/example_app">https://github.com/mluukkai/example_app</a>. Kannattaa huomata, että sovellus on tarkoitettu ainoastaan kurssin käsitteistöä demonstroivaksi esimerkiksi, koodi on osin tyyliltään huonoa ja siitä ei tulee ottaa mallia omia sovelluksia tehdessä.</p>

<h2 id="kirjastot">kirjastot</h2>

<p>Kurssin esimerkkisovellus on tehty ns. <a href="https://medium.freecodecamp.org/is-vanilla-javascript-worth-learning-absolutely-c2c67140ac34">vanilla Javascriptillä</a> eli käyttäen pelkkää DOM-apia ja Javascript-kieltä sivujen rakenteen manipulointiin.</p>

<p>Pelkän Javascriptin ja DOM-apin käytön sijaan Web-ohjelmoinnissa hyödynnetään usein kirjastoja, jotka sisältävät DOM-apia helpommin käytettäviä tykaluja sivujen muokkaukseen. Eräs tälläinen kirjasto on edelleenkin hyvin suosittu <a href="https://jquery.com/">JQuery</a>.</p>

<p>JQuery on kehitetty ainkana, jolloin web-sivut olivat vielä suurimmaksi osaksi perinteisiä, eli palvelin muodosti HTML-sivuja joiden toiminnallisuutta rikastettiin selaimessa JQueryllä kirjoitetun Javascript-koodin avulla.</p>

<p>Single page app -tyylin noustua suosioon on ilmestynyt useita JQueryä “modernempia” tapoja sovellusten kehittämiseen. Googlen kehittämä <a href="https://angularjs.org/">AngularJS</a> oli erittäin vielä muutama vuosi sitten erittäin suosittu. Angularin suosio kuitenkin romahti siinä vaiheessa kun Angular-tiimi <a href="https://jaxenter.com/angular-2-0-announcement-backfires-112127.html">ilmoitti</a> lokakuussa 2014, että version 1 tuki lopetetaan ja Angular 2 ei tule olemaan taaksepäin yhteensopiva ykkösversion kanssa. Angular 2 ja uudemmat versiot eivät ole saaneet kovin innostunutta vastaanottoa.</p>

<p>Nykyisin suosituin tapa toteuttaa web-sovellusten selainpuolen logiikka on Facebookin kehittämä <a href="https://reactjs.org/">ReactJS</a>-kirjasto. Tulemme tutustumaan kurssin aikana Reactiin ja sen kanssa yleisesti käytettyyn <a href="https://github.com/reactjs/redux">Redux</a>-kirjastoon.</p>

<p>Reactin asema näyttää tällä hetkellä vahvalta, mutta Javascript-maailma ei lepää koskaan. Viime aikoina huomioita on alkanut kiinnittää mm. uudempi tulokas <a href="https://vuejs.org/">VueJS</a>.</p>

<h2 id="full-stack--websovelluskehitys">full stack -websovelluskehitys</h2>

<p>Mitä tarkoitetaan kurssin nimellä <em>full stack -websovelluskehitys</em>? Full stack on hypen omainen termi, kaikki puhuvat siitä, mutta kukaan ei oikein tiedä mitä se tarkoittaa tai ainakaan mitään yhteneväistä määritelmää termille ei ole.</p>

<p>Käytännössä kaikki websovellukset sisältävät (ainakin) kaksi “kerrosta”, ylempänä olevan selaimen ja alla olevan palvelimen. Palvelimen alapuolella on usein vielä tietokanta. Näin websovelluksen arkkitehtuuri on “stack”, eli pino. Websovelluskehityksen yhteydessä puhutaan usein myös “frontista” (<a href="https://en.wikipedia.org/wiki/Front_and_back_ends">frontend</a>) ja “backistä” (<a href="https://en.wikipedia.org/wiki/Front_and_back_ends">backend</a>).</p>

<p>Selain on fronend ja selaimessa suoritettava javascript on fronend-koodia. Palvelimella taas pyörii backend-koodi.</p>

<p>Tämän kurssin kontekstissa full stack -sovelluskehitys tarkoittaa sitä, että kiinnostus on kaikissa sovelluksen osissa, niin frontendissä kuin backendissäkin.</p>

<p>Ohjelmoimme myös palvelinpuolta, eli backendia Javascriptilla, käyttäen <a href="https://nodejs.org/en/">node.js</a>-suoritusympäristöä. Näin full stack -sovelluskehitys saa vielä uuden ulottuvuuden, käytämme samaa kieltä pinon kaikissa osissa. Full stack -sovelluskehitys ei välttämättä edellytä sitä että kaikissa sovelluksen kerroksissa on käytössä sama kieli (javascript). Termi on kuitenkin (todennäköisesti) lanseerattu vasta sen jälkeen kun Node.js mahdollisti Javascriptin käyttämisen kaikkialla.</p>

<p>Aiemmin on ollut yleisempää, että sovelluskehittäjät ovat erikoistuneet tiettyyn sovelluksen osaan, esim. backendiin. Tekniikat backendissa ja frontendissa ovat saattaneet olla hyvin erilaisia. Full stack -trendin myötä on tullut tavanomaiseksi että sovelluskehittäjä hallitsee riittävästi kaikilta sovelluksen tasoilta. Usein full stack -kehittäjän on myös omattava riittävä määrä konfiguraatio- ja ylläpito-osaamista jotta kehittäjä pystyy operoimaan sovellustaan esim. pilvipalveluissa.</p>

<h2 id="javascript-fatigue">Javascript fatigue</h2>

<p>Full stack -sovelluskehitys on monella tapaa haastavaa. Asioita tapahtuu monessa paikassa ja mm. debuggaaminen on oleellisti normaalia työpöytäsovellusta hankalampaa. Javascript ei toimi aina niinkuin sen olettaisi toimivan. Verkon yli tapahtuva kommunikointi edellyttää HTTP-protokollan tuntemusta. On tunnettava myös tietokantoja ja hallittava palvelinten konfigurointia ja ylläpitoa. Hyvä olisi myös hallita riittävästi CSS:ää, jotta sovellukset saataisiin edes siedettävän näköisiksi.</p>

<p>Oman haasteensa tuo vielä se, että Javascript-maailma etenee koko ajan kovaa vauhtia eteenpäin. Kirjastot, työkalut ja itse kielikin ovat jatkuvan kehityksen alla. Osa alkaa kyllästyä nopeaan kehitykseen ja sitä kuvaamaan on lanseerattu termi <a href="https://medium.com/@ericclemmons/javascript-fatigue-48d4011b6fc4">Javascript</a> <a href="https://auth0.com/blog/how-to-manage-javascript-fatigue/">fatigue</a> eli <a href="https://hackernoon.com/how-it-feels-to-learn-javascript-in-2016-d3a717dd577f">Javascript</a>-väsymys.</p>

<p>Jaavascript-väsymys tulee varmasti iskemään myös tällä kurssilla. Onneksi nykyään on olemassa muutamia tapoja loiventaa oppimiskäyrää, ja voimme aloittaa keskittymällä konfiguraation sijaan koodaamiseen. Konfiguraatioita ei voi välttää, mutta seuraavat pari viikkoa voimme edetä iloisin mielin vailla pahimpia konfiguraatiohelvettejä.</p>

<h2 id="react">React</h2>

<p>Alamme nyt tutustua kurssin ehkä tärkeimpään teemaan, <a href="https://reactjs.org/">React</a>-kirjastoon.</p>

<p>Tedään nyt yksinkertainen React-sovellus ja tutustutaan samalla Reactin peruskäsitteistöön.</p>

<p>Ehdottomasti helpoin tapa päästä alkuun on asentaa <a href="https://github.com/facebookincubator/create-react-app">create-react-app</a>.</p>

<p>Luodaan sovellus nimeltään <em>viikko1</em> ja käynnistetään se:</p>

<pre>
$ create-react-app viikko1
$ cd viikko1
$ npm start
</pre>

<p>Chromen pitäisi aueta automaattisesti. Avaa konsoli <strong>välittömästi</strong>. Avaa myös tekstieditori siten, että näet koodin ja web-sivun samaan aikaan ruudulla:</p>

<p><img src="http://localhost:4000/assets/1/26.png" alt="" /></p>

<p>Sovelluksessa on hieman valmista koodia, mutta yksinkertaistetaan koodi siten, että tiedoston <em>index.js</em> sisällöksi tulee:</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">React</span> <span class="k">from</span> <span class="s1">'react'</span>
<span class="k">import</span> <span class="nx">ReactDOM</span> <span class="k">from</span> <span class="s1">'react-dom'</span>

<span class="kd">const</span> <span class="nx">App</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">(</span>
  <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Hello world<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">)</span>

<span class="nx">ReactDOM</span><span class="p">.</span><span class="nx">render</span><span class="p">(&lt;</span><span class="nc">App</span> <span class="p">/&gt;,</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">'root'</span><span class="p">))</span>
</code></pre></div></div>

<p>Voit poistaa tiedostot <em>App.css</em>, <em>App.test.js</em>, <em>logo.svg</em> ja <em>registerServiceWorkes.js</em>
Jätä tiedosto <em>App.js</em>, tulemme tarvitsemaan sitä myöhemin.</p>

<h3 id="komponentti">komponentti</h3>

<p>Tiedosto <em>index.js</em> määrittelee nyt React <a href="https://reactjs.org/docs/components-and-props.html">komponentin</a> nimeltään <em>App</em>.</p>

<p>Komento</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">ReactDOM</span><span class="p">.</span><span class="nx">render</span><span class="p">(&lt;</span><span class="nc">App</span> <span class="p">/&gt;,</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">'root'</span><span class="p">))</span>
</code></pre></div></div>

<p>Renderöi komponentin sisällön tiedoston <em>public/index.html</em> määrittelemään <em>div</em>-elementtiin, jonka <em>id:n</em> arvona on ‘root’</p>

<p>Tiedosto <em>public/index.html</em> on oleellisesti ottaen tyhjä, voit kokeilla lisätä sinne HTML:ää. Reactilla ohjelmoitaessa yleensä kuitenkin kaikki renderöitävä sisältä määritellään reactin komponenttien avulla.</p>

<p>Tarkastellaan vielä tarkemmin komponentin määrittelevää koodia:</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">App</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">(</span>
  <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Hello world<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">)</span>
</code></pre></div></div>

<p>Kuten arvata saattaa, komponentti renderöityy <em>div</em>-tagina, jonka sisällä on <em>p</em>-tagin sisällä oleva teksti <em>Hello world</em>.</p>

<p>Teknisesti ottaen komponentti on määritelty Javascript-funktiona. Seuraava siis on funktio:</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">()</span> <span class="o">=&gt;</span> <span class="p">(</span>
  <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Hello world<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">)</span>
</code></pre></div></div>

<p>joka sijoitetaan vakioarvoiseen muuttujaan <em>App</em></p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">App</span> <span class="o">=</span> <span class="p">...</span>
</code></pre></div></div>

<p>Javascriptissa on muutama tapa määritellä funktioita. Käytämme nyt javascriptin hieman uudemman version <a href="http://es6-features.org/#Constants">EcmaScript 6:n</a> eli ES6:n <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Functions/Arrow_functions">nuolifunktiota</a></p>

<p>Koska funktio koostuu vain yhdestä lausekkeesta, on käytössämme lyhennysmerkintä, joka vastaa oikeasti seuraavaa koodia:</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">App</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span><span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Hello world<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">)}</span>
</code></pre></div></div>

<p>eli funktio palauttaa sisältämänsä lausekkeen arvon.</p>

<p>Komponenttifunktio voi sisältää mitä tahansa javascript-koodia. Muuta komponenttisi seuraavaan muotoon ja katso mitä konsolissa tapahtuu:</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">App</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Hello from komponentti'</span><span class="p">)</span>
  <span class="k">return</span><span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Hello world<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">)}</span>
</code></pre></div></div>

<p>Komponenttien sisällä on mahdollista renderöidä myös dynaamista sisältöä.</p>

<p>Muuta komponentti muotoon:</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">App</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">now</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">()</span>
  <span class="kd">const</span> <span class="nx">a</span> <span class="o">=</span> <span class="mi">10</span>
  <span class="kd">const</span> <span class="nx">b</span> <span class="o">=</span> <span class="mi">20</span>
  <span class="k">return</span><span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Hello world, it is <span class="si">{</span><span class="nx">now</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span><span class="si">}</span><span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span><span class="si">{</span><span class="nx">a</span><span class="si">}</span> plus <span class="si">{</span><span class="nx">b</span><span class="si">}</span> is <span class="si">{</span><span class="nx">a</span><span class="o">+</span><span class="nx">b</span><span class="si">}</span><span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">)}</span>
</code></pre></div></div>

<p>Aaltosulkeiden sisällä oleva javascript-koodi evaluoidaan ja evaluoinnin tulos upotetaan määriteltyyn kohtaan komponentin HTML-koodia.</p>

<h3 id="jsx">JSX</h3>

<p>Näyttää siltä, että React-komponetti palauttaa HTML-koodia. Näin ei kuitenkaan ole. React-komponenttien ulkoasu kirjoitetaan yleensä <a href="https://reactjs.org/docs/introducing-jsx.html">JSX</a>:ää käyttäen. Vaikka JSX näyttää HTML:ltä, kyseessä on kuitenkin tapa kirjoittaa javascriptiä. React komponenttien palauttaman JSX:n javascriptiksi.</p>

<p>Käännösvaiheen jälkeen ohjelmamme näyttää seuraavalta:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">React</span> <span class="k">from</span> <span class="s1">'react'</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">ReactDOM</span> <span class="k">from</span> <span class="s1">'react-dom'</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">App</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">now</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">();</span>
  <span class="kd">const</span> <span class="nx">a</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">b</span> <span class="o">=</span> <span class="mi">20</span><span class="p">;</span>
  <span class="k">return</span> <span class="nx">React</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span>
    <span class="s1">'div'</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span>
    <span class="nx">React</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span>
      <span class="s1">'p'</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="s1">'Hello world, it is '</span><span class="p">,</span> <span class="nx">now</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>
    <span class="p">),</span>
    <span class="nx">React</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span>
      <span class="s1">'p'</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">a</span><span class="p">,</span><span class="s1">' plus '</span><span class="p">,</span><span class="nx">b</span><span class="p">,</span> <span class="s1">' is '</span><span class="p">,</span> <span class="nx">a</span> <span class="o">+</span> <span class="nx">b</span>
    <span class="p">)</span>
  <span class="p">);</span>
<span class="p">};</span>

<span class="nx">ReactDOM</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="nx">React</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="nx">App</span><span class="p">,</span> <span class="kc">null</span><span class="p">),</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">'root'</span><span class="p">));</span>
</code></pre></div></div>

<p>Käännksen hoitaa <a href="https://babeljs.io/repl/">Babel</a>. Create-react-app:illa luoduissa projekteissa käännös tapahtuu konepellin alla. Tulemme tutustumaan aiheeseen tarkemmin myöhemmin kurssilla.</p>

<p>Reactia olisi myös mahdollista kirjoittaa “suoraan javascriptinä” käyttämättä JSX:ää. Kukaan täysijärkinen ei kuitenkaan niin tee,</p>

<p>Käytännössä JSX on melkein kuin HTML:ää sillä erotuksella, että mukaan voi upottaa helposti dynaamista sisältöä kirjoittamalla sopivaa javascriptiä aaltosulkeiden takaan. Käytännössä JSX on melko lähellä monia palvelimella käytettäviä templating-kieliä kuten Java Springin yhteydessä käytettävää thymeleafia.</p>

<h2 id="monta-komponenttia">monta komponenttia</h2>

<p>Muutetaan sovellusta seuraavasti (yläreunan importit jätetään nyt ja jatkossa pois):</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">Hello</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Hello world<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">)</span>  
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">App</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Greetings<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nc">Hello</span> <span class="p">/&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">)</span>
<span class="p">}</span>

<span class="nx">ReactDOM</span><span class="p">.</span><span class="nx">render</span><span class="p">(&lt;</span><span class="nc">App</span> <span class="p">/&gt;,</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">'root'</span><span class="p">))</span>
</code></pre></div></div>

<p>Olemme määritelleet uuden komponentin <em>Hello</em> jota käytetään komponentista <em>App</em>. Komponenttia voidaan luonnollisesti käyttää monta kertaa:</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">App</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Greetings<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nc">Hello</span> <span class="p">/&gt;</span>
      <span class="p">&lt;</span><span class="nc">Hello</span> <span class="p">/&gt;</span>
      <span class="p">&lt;</span><span class="nc">Hello</span> <span class="p">/&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Komonenttien tekeminen Reactissa on helppoa ja komponentteja yhdistelemällä monimutkaisempikin sovellus on mahdollista pitää kohtuulliseti ylläpidettävänä. Reactissa on filosofiana onkin koostaa sovellus useista, pieneen asiaan keskittyvistä uudelleenkäytettävistä komponenteista.</p>

<p>Jatkamme komponentteihin tutustumista.</p>

<h2 id="props-tiedonvälitys-komponenttien-välillä">props: tiedonvälitys komponenttien välillä</h2>

<p>Komponenteille on mahdollista välittää dataa <a href="https://reactjs.org/docs/components-and-props.html">propsien</a> avulla.</p>

<p>Muutetaan komponenttia <em>Hello</em> seuraavasti</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">Hello</span> <span class="o">=</span> <span class="p">(</span><span class="nx">props</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Hello <span class="si">{</span><span class="nx">props</span><span class="p">.</span><span class="nx">name</span><span class="si">}</span><span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">)</span>  
<span class="p">}</span>
</code></pre></div></div>

<p>komponentin määrittelevällä funktiolla on nyt parametri <em>props</em>. Parametri saa arvokseen olion, jonka kenttinä ovat kaikki eri “propsit”, jota komponentin käyttäjä määrittelee.</p>

<p>Propsit määritellään seuraavasti:</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">App</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Greetings<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nc">Hello</span> <span class="na">name=</span><span class="s1">'Arto'</span> <span class="p">/&gt;</span>
      <span class="p">&lt;</span><span class="nc">Hello</span> <span class="na">name=</span><span class="s1">'Pekka'</span> <span class="p">/&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Propseja voi olla mielivaltainen lukumäärä ja niiden arvot voivat olla “kovakoodattuja” tai javascript-lausekkeiden tuloksia. Jos propsin arvo muodostetaan javascriptillä, tulee se olla aaltosulkeissa.</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">Hello</span> <span class="o">=</span> <span class="p">(</span><span class="nx">props</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Hello <span class="si">{</span><span class="nx">props</span><span class="p">.</span><span class="nx">name</span><span class="si">}</span>, you are <span class="si">{</span><span class="nx">props</span><span class="p">.</span><span class="nx">age</span><span class="si">}</span> years old<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">)</span>  
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">App</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">nimi</span> <span class="o">=</span> <span class="s1">'Pekka'</span>
  <span class="kd">const</span> <span class="nx">ika</span> <span class="o">=</span> <span class="mi">10</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Greetings<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nc">Hello</span> <span class="na">name=</span><span class="s1">'Arto'</span> <span class="na">age=</span><span class="si">{</span><span class="mi">26</span><span class="o">+</span><span class="mi">10</span><span class="si">}</span> <span class="p">/&gt;</span>
      <span class="p">&lt;</span><span class="nc">Hello</span> <span class="na">name=</span><span class="si">{</span><span class="nx">nimi</span><span class="si">}</span> <span class="na">age=</span><span class="si">{</span><span class="nx">ika</span><span class="si">}</span> <span class="p">/&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="muutama-huomio">Muutama huomio</h3>

<p>React on konfiguroitu antamaan varsin hyviä virheilmoituksia. Kannattaa kuitenkin edetä ainakin alussa <strong>todella pienin askelin</strong> ja varmistaa, että jokainen muutos toimii halutulla tavalla.</p>

<p>Konsolin tulee olla <strong>koko ajan auki</strong>. Jos selain ilmoittaa virheestä, ei kannata kirjoittaa sokeasti lisää koodia ja toivoa ihmettä tapahtuvaksi vaan tulee yrittää ymmärtää virheen syy ja esim. palata edelliseen toimivaan tilaan:</p>

<p><img src="http://localhost:4000/assets/1/27.png" alt="" /></p>

<p>Kannattaa myös muistaa, että React-koodissakin on mahdollista ja kannattavaa lisätä koodin sekaan sopivia <code>console.log()</code>-komentoja. Tulemme hieman myöhemmin tutustumaan muutamiin muihinkin tapoihin debugata reactia.</p>

<p>React-komponenttien nimien tulee alkaa isolla kirjaimella. Jos yrität määritellä komponentin seuraavasti</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">footer</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span><span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>greeting app created by <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href=</span><span class="s1">'https://github.com/mluukkai'</span><span class="p">&gt;</span>mluukkai<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<p>ja ottaa sen käyttöön</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">App</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Greetings<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nc">Hello</span> <span class="na">name=</span><span class="s1">'Arto'</span> <span class="na">age=</span><span class="si">{</span><span class="mi">26</span><span class="o">+</span><span class="mi">10</span><span class="si">}</span> <span class="p">/&gt;</span>
      <span class="p">&lt;</span><span class="nt">footer</span> <span class="p">/&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<p>sivulle ei kuitenkaan tule mitään, sillä React ei luo sivulle ainoastaan tyhjän <em>div</em>-elementin. Jos muutat komponentin nimen alkamaan isolla kirjaimella, kaikki toimii taas.</p>

<h3 id="react-tehtävät-osa-1">react-tehtävät, osa 1</h3>

<h2 id="javascriptiä">Javascriptiä</h2>

<p>Kurssin aikana on websovelluskehityksen rinnalla tavoite ja tarve oppia riittävässä määrin Javascritpiä.</p>

<p>Javascript on kehittynyt viime vuosina nopeaan tahtiin, ja käytämme kurssilla kielen uusimpien versioiden piirteitä, joista osa ei ole vielä olemassa kielen standardoiduissa versiossa. Javascript-standardin virallinen nimi on <a href="https://en.wikipedia.org/wiki/ECMAScript">ECMAScript</a>. Tämän hetken tuorein version on kesäkuussa 2017 julkaistu <a href="https://www.ecma-international.org/publications/standards/Ecma-262.htm">ES8</a>, toiselta nimeltään ECMAScript 2017.</p>

<p>Selaimet eivät vielä osaa kaikkia Javascriptin uusimpien versioiden ominaisuuksia. Tämän takia selaimessa suoritetaan useimmiten koodia joka on käännetty tai englanniksi <em>transpiled</em> uudemmasta javascriptin versiosta johonkin vanhempaan, paremmin tuettuun versioon.</p>

<p>Tällä hetkellä johtava tapa tehdä transpilointi on <a href="https://babeljs.io/">Babel</a>. Create-react-app:in avulla luodoissa React-sovelluksissa on valmiiksi konfiguroitu automaattinen traspilaus. Katsomme myöhemmin kurssilla, tarkemmin miten transpiloinnin konfigurointi tapahtuu.</p>

<p><a href="https://nodejs.org/en/">NodeJS</a> on melkein missä vaan, mm. palvelimilla toimiva, Googlen <a href="https://developers.google.com/v8/">chrome V8</a>-javascriptmoottoriin perustuva javascritpsuoritusympäristö. Harjoitellaan hieman Javascriptiä Nodella. Tässä oletetaan, että koneellasi on NodeJS:stä vähintään versio <em>v8.6.0</em>. Noden tuoreet versiot osaavat suoraan javascriptin uusia versioita, joten koodin transpilaus ei ole tarpeen.</p>

<p>Koodi kirjoitetaan <em>.js-</em>päätteiseen tiedostoon, ja suoritetaan komennolla <code>node tiedosto.js</code></p>

<p>Javascript muistuttaa nimensä ja syntaksinsa puolesta läheisesti Javaa. Perusmekanismeiltaan kielet kuitenkin poikkeavat radikaalisti. Java-taustalta tultaessa Javascriptin käyttäytyminen saattaa aiheuttaa hämmennystä, varsinkin jos kielen piirteistä ei viitsitä ottaa selvää.</p>

<p>Tietyissä piireissä on myös ollut suosittua yrittää “simuloida” Javascriptilla eräitä Javan piirteitä ja ohjelmointitapoja. En suosittele.</p>

<h3 id="muuttujat">muuttujat</h3>

<p>Javascriptissä on kolme tapaa määritellä muttujia:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">x</span> <span class="o">=</span> <span class="mi">1</span>
<span class="kd">let</span> <span class="nx">y</span> <span class="o">=</span> <span class="mi">5</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span>  <span class="c1">// tulostuu 1, 5</span>
<span class="nx">y</span> <span class="o">+=</span> <span class="mi">10</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span>  <span class="c1">// tulostuu 1, 15</span>
<span class="nx">y</span> <span class="o">=</span> <span class="s1">'teksti'</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span>  <span class="c1">// tulostuu 1, teksti</span>
<span class="nx">x</span> <span class="o">=</span> <span class="mi">4</span>              <span class="c1">// aiheuttaa virheen</span>
</code></pre></div></div>

<p><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/const">const</a> ei oikeastaan määrittele muuttujaa vaan <em>vakion</em>, jonka arvoa ei voi enää muuttaa. <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/let">let</a> taas määrittelee normaalin muuttujan. Javascriptissa on myös mahdollista määritellä  muuttujia avainsanan <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/var">var</a> avulla. Älä käytä tällä kurssilla varia, käytä aina const:ia tai let:iä!</p>

<p>Esimerkistä näemme myös, että muuttujalla voi vaihtaa tyyppiä suorituksen aikana, <em>y</em> tallettaa aluksi luvun ja lopulta merkkijonon.</p>

<h3 id="taulukot">taulukot</h3>

<p><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array">Taulukko</a>  ja muutama esimerkki sen käytöstä</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">t</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>

<span class="nx">t</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> 

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">t</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span>  <span class="c1">// tulostuu 4</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">t</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>      <span class="c1">// tuostuu -1</span>

<span class="nx">t</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span> <span class="p">(</span><span class="nx">luku</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span> 
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">luku</span><span class="p">)</span>    <span class="c1">// tulostuu 1, -1, 3 ja 5 omille riveilleen</span>
<span class="p">})</span>

<span class="nx">t</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="mi">99</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">t</span><span class="p">)</span>         <span class="c1">// tulostuu [ 1, -1, 3, 5, &lt;2 empty items&gt;, 99 ]</span>
</code></pre></div></div>

<p>Huomattavaa esimerkissä on se, että taulukon sisältöä voi muuttaa vaikka sen on määritelty _const_iksi. Koska taulukko on olio, viittaa muuttuja koko ajan samaan olioon. Olion sisältö muuttuu sitä mukaa kun talukkoon lisätään uusia alkioita.</p>

<p>Eräs tapa käydä taulukon alkiot läpi on esimerkissä käytetty <em>forEach</em>, joka saa parametrikseen nuolisyntaksilla määritellyn <em>funktion</em></p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="nx">luku</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span> 
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">luku</span><span class="p">)</span>    <span class="c1">// tulostuu 1, -1, 3 ja 5 omille riveilleen</span>
<span class="p">}</span>
</code></pre></div></div>

<p>forEach kutsuu funktiota jokaiselle taulukon alkiolle antaen taulukon alkion aina parametrina. forEachin parametrina oleva funktio voi saada myös <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/forEach">muita parametreja</a>.</p>

<p>Taulukoille on määritelty runsaasti hyödyllisiä operaatioita, tutustumme niihin tarkemmin laskareissa. Katsotaan kuiten jo nyt pieni esimerkki operaation <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/map">map</a> käytöstä.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">t</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>

<span class="kd">const</span> <span class="nx">m1</span> <span class="o">=</span> <span class="nx">t</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">luku</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">luku</span><span class="o">*</span><span class="mi">2</span> <span class="p">)</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">m1</span><span class="p">)</span> <span class="c1">// tulostuu 2, 4, 6, 8</span>

<span class="kd">const</span> <span class="nx">m2</span> <span class="o">=</span> <span class="nx">t</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">luku</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="s1">'&lt;li&gt;'</span><span class="o">+</span><span class="nx">luku</span><span class="o">+</span><span class="s1">'&lt;/li&gt;'</span><span class="p">)</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">m2</span><span class="p">)</span> <span class="c1">// tulostuu [ '&lt;li&gt;1&lt;/li&gt;', '&lt;li&gt;2&lt;/li&gt;', '&lt;li&gt;3&lt;/li&gt;', '&lt;li&gt;4&lt;/li&gt;' ]</span>
</code></pre></div></div>

<p>Map siis muodostaa taulukon perusteella uuden taulukon, jonka jokainen alkio muodostetaan map:in parametrina olevan funktion avulla. Kuten tulemme pian näkemään, mapia käytetään Reactissa todella usein.</p>

<h3 id="oliot">oliot</h3>

<p>Javasriptissa on muutama tapa määritellä olioita. Erittäin yleisesti käytetään <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Grammar_and_types#Object_literals">olioliteraaleja</a>, eli määritellään olio luettelemalla sen kentät (englanniksi property) aaltosulkeiden sisällä:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">olio1</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">nimi</span><span class="p">:</span> <span class="s1">'Arto Hellas'</span><span class="p">,</span>
  <span class="na">ika</span><span class="p">:</span> <span class="mi">35</span><span class="p">,</span>
  <span class="na">koulutus</span><span class="p">:</span> <span class="s1">'Filosofian tohtori'</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">olio2</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">nimi</span><span class="p">:</span> <span class="s1">'Full Stact -websovelluskehitys'</span><span class="p">,</span>
  <span class="na">taso</span><span class="p">:</span> <span class="s1">'aineopinto'</span><span class="p">,</span>
  <span class="na">laajuus</span><span class="p">:</span> <span class="mi">5</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">olio3</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">nimi</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">etunimi</span><span class="p">:</span> <span class="s1">'Jami'</span><span class="p">,</span>
    <span class="na">sukunimi</span><span class="p">:</span> <span class="s1">'Kousa'</span>
  <span class="p">},</span>
  <span class="na">arvosanat</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
  <span class="na">laitos</span><span class="p">:</span> <span class="s1">'TKTL'</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Kentät voivat olla mielivaltaista javascriptin tyyppiä. Olioiden kenttiin viitataan pistenotaatiolla.</p>

<p>Olioille voidaan lisätä kenttiä myös lennossa joko pistenotaation tai kulmasulkeiden avulla:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">olio1</span><span class="p">.</span><span class="nx">osoite</span> <span class="o">=</span> <span class="s1">'Tapiola'</span>
<span class="nx">olio1</span><span class="p">[</span><span class="s1">'salainen numero'</span><span class="p">]</span> <span class="o">=</span> <span class="mi">12341</span>
</code></pre></div></div>

<p>Jälkimäinen lisäysksistä on pakko tehdä kulmasulkeiden avulla, sillä pistenotaatiota käytettäessä ‘salainen numero’ ei kelpaa kentän nimeksi.</p>

<p>Javascriptissä olioilla voi luonnollisesti olla myös metodeja. Palaamme aiheeseen funktioiden käsittelyn jälkeen.</p>

<p>Olioita on myös mahdollista määritellä ns. konstruktorifunktioiden avulla, jolloin saadaan aikaan hieman monien ohjelmointikielten, esim. Javan luokkia (class) muistuttava mekansimi. Javascriptissä ei kuitenkaan ole luokkia samassa mielessä kuin olio-ohjelmointikieleissä. Kieleen on kuitenkin lisätty versiosta ES6 alkaen <em>luokkasyntaksi</em>, joka helpottaa tietyissä tilanteissa olio-ohjelmointikielimäisten luokkien esittämistä. Palaamme asiaan hetken kuluttua.</p>

<p>Reactissa konstruktorifunktioihin perustuvalle olioiden määrittelyyn ei ole kovin usein tarvetta, joten sivuutamme sen ainakin toistaiseksi.</p>

<h3 id="funktiot">funktiot</h3>

<p>Olemme jo tutustuneet ns. nuolifunktioiden määrittelyyn. Täydellinen tapa nuolifunktion määrittelyyn on seuraava</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">summa</span> <span class="o">=</span> <span class="p">(</span><span class="nx">p1</span><span class="p">,</span> <span class="nx">p2</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">p1</span><span class="p">)</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">p2</span><span class="p">)</span>
  <span class="k">return</span> <span class="nx">p1</span><span class="o">+</span><span class="nx">p2</span>
<span class="p">}</span>
</code></pre></div></div>

<p>ja funktiota kutsutaan kuten olettaa saattaa</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">vastaus</span> <span class="o">=</span> <span class="nx">summa</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">vastaus</span><span class="p">)</span>
</code></pre></div></div>

<p>Jos parameteja on vain yksi, voidaan sulut jättää määrittelystä pois:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">nelio</span> <span class="o">=</span> <span class="nx">p</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">p</span><span class="p">)</span>
  <span class="k">return</span> <span class="nx">p</span><span class="o">*</span><span class="nx">p</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Jos funktio sisältää ainoastaan yhden lausekkeen, ei aaltosulkeita tarvita. Tällöin funktio palauttaa ainoan lausekkeensa arvon. Eli edellinen voitaisiin ilmaista lyhemmin seuraavasti:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">nelio</span> <span class="o">=</span> <span class="nx">p</span> <span class="o">=&gt;</span> <span class="nx">p</span><span class="o">*</span><span class="nx">p</span>
</code></pre></div></div>

<p>Tämä muoto on erityisen kätevä käsiteltäessä taulukkoja esim. map-metodin avulla:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">t</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="kd">const</span> <span class="nx">tnelio</span> <span class="o">=</span> <span class="nx">t</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">p</span> <span class="o">=&gt;</span> <span class="nx">p</span><span class="o">*</span><span class="nx">p</span><span class="p">)</span>
<span class="c1">// tnelio on nyt [1, 2, 3]</span>
</code></pre></div></div>

<p>Nuolifunktio on tullut javascriptiin vasta muutama vuosi sitten version <a href="http://es6-features.org/">ES6</a> myötä. Tätä ennen ja paikoin nykyäänkin funktioden määrittely tapahtui avainsanan <em>function</em> avulla.</p>

<p>Määrittelytapoja on kaksi, funktiolle voidaan antaa <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/function">function declaration</a> tyyppisessä määrittelyssä <em>nimi</em> jonka avulla funktioon voidaan viitata:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">tulo</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">a</span><span class="o">*</span><span class="nx">b</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">vastaus</span> <span class="o">=</span> <span class="nx">tulo</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
</code></pre></div></div>

<p>Toinen tapa on tehdä määrittely [funktiolausekkeena]
(https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/function). Tällöin funtiolle ei tarvitse antaa nimeä ja määrittely voi sijaita muun koodin seassa:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">keskiarvo</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">(</span><span class="nx">a</span> <span class="o">+</span> <span class="nx">b</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">vastaus</span> <span class="o">=</span> <span class="nx">keskiarvo</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="olioiden-metodit-ja-this">olioiden metodit ja this</h3>

<p>Kaikille kolmelle tavalle määritellä funktio on oma paikkansa.</p>

<p>Nuolifunktiot ja avainsanan <em>function</em> avulla määritellyt funktiot kuitenkin poikkeavat radikaalisti siitä miten ne käyttytyvät <em>this</em> avainsanan suhteen.</p>

<p>Voimme liittää oliolle metodeja määrittelemällä niille kenttiä, jotka ovat funktioita:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">arto</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">nimi</span><span class="p">:</span> <span class="s1">'Arto Hellas'</span><span class="p">,</span>
  <span class="na">ika</span><span class="p">:</span> <span class="mi">35</span><span class="p">,</span>
  <span class="na">koulutus</span><span class="p">:</span> <span class="s1">'Filosofian tohtori'</span><span class="p">,</span>
  <span class="na">tervehdi</span><span class="p">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'hello, my name is'</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">nimi</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nx">arto</span><span class="p">.</span><span class="nx">tervehdi</span><span class="p">()</span>  <span class="c1">// tulostuu hello, my name is Arto Hellas</span>
</code></pre></div></div>

<p>metodeja voidaan liittää olioille myös niiden luomisen jälkeen:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">arto</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">nimi</span><span class="p">:</span> <span class="s1">'Arto Hellas'</span><span class="p">,</span>
  <span class="na">ika</span><span class="p">:</span> <span class="mi">35</span><span class="p">,</span>
  <span class="na">koulutus</span><span class="p">:</span> <span class="s1">'Filosofian tohtori'</span><span class="p">,</span>
  <span class="na">tervehdi</span><span class="p">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'hello, my name is'</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">nimi</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nx">arto</span><span class="p">.</span><span class="nx">vanhene</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">ika</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="p">}</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">arto</span><span class="p">.</span><span class="nx">ika</span><span class="p">)</span>  <span class="c1">// tulostuu 35</span>
<span class="nx">arto</span><span class="p">.</span><span class="nx">vanhene</span><span class="p">()</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">arto</span><span class="p">.</span><span class="nx">ika</span><span class="p">)</span>  <span class="c1">// tulostuu 36</span>
</code></pre></div></div>

<p>Muutetaan olioa hiukan</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">arto</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">nimi</span><span class="p">:</span> <span class="s1">'Arto Hellas'</span><span class="p">,</span>
  <span class="na">tervehdi</span><span class="p">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'hello, my name is'</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">nimi</span><span class="p">)</span>
  <span class="p">},</span>
  <span class="na">laskeSumma</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">a</span><span class="o">+</span><span class="nx">b</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nx">arto</span><span class="p">.</span><span class="nx">laskeSumma</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>   <span class="c1">// tulostuu 5</span>

<span class="kd">const</span> <span class="nx">viiteSummaan</span> <span class="o">=</span> <span class="nx">arto</span><span class="p">.</span><span class="nx">laskeSumma</span>
<span class="nx">viiteSummaan</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">)</span>   <span class="c1">// tulostuu 25</span>
</code></pre></div></div>

<p>Oliolla on nyt metodi, joka osaa laskea summan. Metodia voidaan kutsua normaaliin tapaan olion kautta <code>arto.laskeSumma(1, 4)</code> tai tallettamalla <em>metodiviite</em> muuttujaan ja kutsumalla metodia muuttujan kautta <code>viiteSummaan(10, 15)</code>.</p>

<p>Jos yritämme samaa metodille <em>tervehdi</em>, aiheutuu ongelmia:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">arto</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">nimi</span><span class="p">:</span> <span class="s1">'Arto Hellas'</span><span class="p">,</span>
  <span class="na">tervehdi</span><span class="p">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'hello, my name is'</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">nimi</span><span class="p">)</span>
  <span class="p">},</span>
  <span class="na">laskeSumma</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">a</span><span class="o">+</span><span class="nx">b</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nx">arto</span><span class="p">.</span><span class="nx">tervehdi</span><span class="p">()</span>        <span class="c1">// tulostuu hello, my name is Arto Hellas</span>

<span class="kd">const</span> <span class="nx">viiteTervehdykseen</span> <span class="o">=</span> <span class="nx">arto</span><span class="p">.</span><span class="nx">tervehdi</span>
<span class="nx">viiteTervehdykseen</span><span class="p">()</span>   <span class="c1">// tulostuu hello, my name is undefined</span>
</code></pre></div></div>

<p>Kutsuttaessa metodia viitteen kautta, on metodi kadottanut tiedon siitä mikä oli alkuperäinen <em>this</em>. Toisin kuin melkein kaikissa muissa kielissä <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/this">this</a>:n arvo määrittyy sen mukaan miten olioa on kutsuttu. Kutsuttaessa metodia viitteen kautta, <em>this</em>:in arvoksi tulee ns <a href="https://developer.mozilla.org/en-US/docs/Glossary/Global_object">globaali objekti</a>.</p>

<p>Thisin menettäminen aiheuttaa Reactilla ja Nodella ohjelmoidessa monia potentiaalisia ongelmia. Eteen tulee erittäin usein tilanteita, missä Reactin/Noden (oikeammin ilmaistuna selaimen Javascript-moottorin) tulee kutsua joitan käyttäjän olioiden metodeja. Tälläinen tilanne tulee esim. jos pyytetään Artoa tervehtimään sekunnin kuluttua metodia <a href="https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/setTimeout">setTimeout</a> hyväksikäyttäen.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">arto</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">nimi</span><span class="p">:</span> <span class="s1">'Arto Hellas'</span><span class="p">,</span>
  <span class="na">tervehdi</span><span class="p">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'hello, my name is'</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">nimi</span><span class="p">)</span>
  <span class="p">},</span>
<span class="p">}</span>

<span class="nx">setTimeout</span><span class="p">(</span><span class="nx">arto</span><span class="p">.</span><span class="nx">tervehdi</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
</code></pre></div></div>

<p>Javascriptissa this:in arvo siis määräytyy siitä miten metodia on kutsuttu. setTimeoutia käytettäessä metodia kutsuu Javascript-moottori ja this viittaa Timeout-olioon.</p>

<p>On useita mekanismeja, joiden avulla alkuperäinen <em>this</em> voidaan säilyttää, eräs näistä on <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/bind">bind</a></p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">setTimeout</span><span class="p">(</span><span class="nx">arto</span><span class="p">.</span><span class="nx">tervehdi</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="nx">arto</span><span class="p">),</span> <span class="mi">1000</span><span class="p">)</span>
</code></pre></div></div>

<p>Komento <code>arto.tervehdi.bind(arto)</code> luo uuden funktion, missä se on sitonut <em>this</em>:in tarkottamaan Artoa riippumatta siitä missä metodia kutsutaan.</p>

<p><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Functions/Arrow_functions">Nuolifunktioiden</a> avulla on mahdollista ratkaista eräitä thisiin liittyviä ongelmia. Olioiden metodeina niitä ei kuitenkaan kannata käyttää, sillä silloin <em>this</em> ei toimi ollenkaan. Palaamme nuolifunktioiden this:in käyttäytymiseen myöhemmin.</p>

<p>Jos haluat ymmärtää paremmin javascriptin <em>this</em>:in toimintaa, löytyy internetistä runsaasti materiaalia aiheesta. Esim. <a href="https://egghead.io">egghead.io</a>:n 20 minuutin screencastsarja <a href="https://egghead.io/courses/understand-javascript-s-this-keyword-in-depth">Understand JavaScript’s this Keyword in Depth</a> on erittäin suositeltava!</p>

<h3 id="luokat">luokat</h3>

<p>Kuten aiemmin mainittiin, Javascriptissä ei ole olemassa olio-ohjelmointikielten luokkamekanismia. Javascriptissa on kuitenkin ominaisuuksia, jotka mahdollistavat olio-ohjelmoinnin <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Classes">luokkien</a> “simuloinnin”. Emme mene nyt sen tarkemmin Javascriptin olioiden taustalla olevaan <em>prototyyppiperintämekanismiin</em>.</p>

<p>Tutustumme kuitenkin pikaisesti ES6:n myltä javascriptiin tulleeseen <em>luokkasyntaksiin</em>, joka helpottaa oleellisesti luokkien (tai luokan kaltaisten asioiden) määrittelyä Javascriptissa.</p>

<p>Seuraavassa on määritelyt “luokka” Henkilö ja sille kaksi Henkilö-olioa:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nx">Henkilo</span> <span class="p">{</span>
  <span class="kd">constructor</span><span class="p">(</span><span class="nx">nimi</span><span class="p">,</span> <span class="nx">ika</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">nimi</span> <span class="o">=</span> <span class="nx">nimi</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">ika</span> <span class="o">=</span> <span class="nx">ika</span>
  <span class="p">}</span>
  <span class="nx">tervehdi</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'hello, my name is'</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">nimi</span><span class="p">)</span>  
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">arto</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Henkilo</span><span class="p">(</span><span class="s1">'Arto Hellas'</span><span class="p">,</span> <span class="mi">35</span><span class="p">)</span>
<span class="nx">arto</span><span class="p">.</span><span class="nx">tervehdi</span><span class="p">()</span>

<span class="kd">const</span> <span class="nx">jami</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Henkilo</span><span class="p">(</span><span class="s1">'Jami Kousa'</span><span class="p">,</span> <span class="mi">21</span><span class="p">)</span>
<span class="nx">jami</span><span class="p">.</span><span class="nx">tervehdi</span><span class="p">()</span>
</code></pre></div></div>

<p>Syntaksin osalta luokat ja niistä luodut oliot muistuttavat erittäin paljon esim. Javan olioita. Käyttäytymiseltäänkin ne ovat aika lähellä Javan olioita. Perimmiltään kyseessä on kuitenkin edelleen Javascriptin <a href="https://developer.mozilla.org/en-US/docs/Learn/JavaScript/Objects/Inheritance">prototyyppiperintään</a> perustuvista olioista. Molempien olioiden todellinen tyyppi on <em>Object</em> sillä javascriptissä ei perimmiltään ole muita tyyppejä kuin kuin <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures">Boolean, Null, Undefined, Number, String, Symbol ja Object</a></p>

<p>Luokkasyntaksin tuominen javascriptiin oli osin kiistelty lisäys, ks. esim. <a href="https://github.com/joshburgess/not-awesome-es6-classes">Not Awesome: ES6 Classes</a>  tai <a href="https://medium.com/@rajaraodv/is-class-in-es6-the-new-bad-part-6c4e6fe1ee65">Is “Class” In ES6 The New “Bad” Part?</a></p>

<p>ES6:n luokkasyntaksia käytetään kuitenkin paljon Reactissa ja NodeJS:ssä ja siksi mekin käytämme sitä sopivissa määrin. Olio-ohjelmointimainen luokkahierarkoiden luominen ei kuitenkaan ole Reactin eikä tämän kurssin suositeltavan hengen mukaista. Reactia ohjelmoitaessa pyritään enemmän funktionaaliseen ohjelmointityyliin.</p>

<h3 id="javascript-materiaalia">Javascript-materiaalia</h3>

<p>Javascriptistä löytyy suuret määrät sekä hyvää että huonoa materiaalia verkosta. Tällä sivulla lähes kaikki linkit ovat  <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript">Mozillan javascript -materiaaliin</a></p>

<p>Jo ennen seuraavien tehtävien tekemistä Mozzillan sivuilta kannattaa lukea välittömästi
[A re-introduction to JavaScript (JS tutorial)]
(https://developer.mozilla.org/en-US/docs/Web/JavaScript/A_re-introduction_to_JavaScript)</p>

<p>Jos haluat tutustua todella syvällisesti Javascritpiin, löytyy internetistä ilmaiseksi mainio kirjasarja <a href="https://github.com/getify/You-Dont-Know-JS">You-Dont-Know-JS</a></p>

<p><a href="https://egghead.io">egghead.io</a>:lla on tarjolla runsaasti laadukkaita screencasteja Javascriptista, Reactista ym. kiinnostavasta. Valitettavasti materiaali on osittain maksullista.</p>

<h3 id="tehtäviä-javascriptistä">tehtäviä javascriptistä</h3>

<h2 id="paluu-reactin-äärelle">paluu Reactin äärelle</h2>

<p>Palataan jälleen Reactin pariin.</p>

<p>Aiemmassa esimerkissämme käytimme funktionaalisia komponentteja, eli määrittelimme kaikki komponentit nuolifunktioiden avulla, esim:</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">Hello</span> <span class="o">=</span> <span class="p">(</span><span class="nx">props</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Hello <span class="si">{</span><span class="nx">props</span><span class="p">.</span><span class="nx">name</span><span class="si">}</span>, you are <span class="si">{</span><span class="nx">props</span><span class="p">.</span><span class="nx">age</span><span class="si">}</span> years old<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">)</span>  
<span class="p">}</span>
</code></pre></div></div>

<p>Toinen tapa komponenttien määrittelyyn on käyttää luokkasyntaksia. Tällöin komponetti määritellään luokaksi, joka perii <a href="https://reactjs.org/docs/react-component.html">React.Component</a>-luokan.</p>

<p>Muutetaan esimerkkisovelluksen komponentti <em>Hello</em> seuraavasti:</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nx">Hello</span> <span class="kd">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span>
      <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Hello <span class="si">{</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">name</span><span class="si">}</span>, you are <span class="si">{</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">age</span><span class="si">}</span> years old<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">)</span>  
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Luokkakomponenttien tulee määritellä ainakin metodi <em>render</em> joka palauttaa komponentin ulkoasun. Luokkakomponentissa viitataan komponentin <em>propseihin</em> this-viitteen kautta.
Eli koska komponenttia käytetään seuraavasti</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&lt;</span><span class="nx">Hello</span> <span class="nx">name</span><span class="o">=</span><span class="s1">'Arto'</span> <span class="nx">age</span><span class="o">=</span><span class="p">{</span><span class="mi">36</span><span class="p">}</span> <span class="sr">/</span><span class="err">&gt;
</span></code></pre></div></div>

<p>Päästään nimeen ja ikään käsiksi luokkamuotoisen komponentin sisällä viittaamalla <em>this.props.name</em> ja <em>this.props.age</em>. Huomaa ero luokkamuotoiseen komponenttiin.</p>

<p>Luokkakomponenteille voidaan tarvittaessa määritellä muitakin metodeja ja “oliomuuttujua”, eli kenttiä.</p>

<p>Voisimme esim. määritellä apumuuttujan seuraavasti:</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nx">Hello</span> <span class="kd">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
  <span class="nx">bornYear</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">yearNow</span> <span class="o">=</span> <span class="mi">1900</span> <span class="o">+</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">getYear</span><span class="p">()</span>
    <span class="k">return</span> <span class="nx">yearNow</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">age</span>
  <span class="p">}</span>
  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span>
      <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>
          Hello <span class="si">{</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">name</span><span class="si">}</span>, you are <span class="si">{</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">age</span><span class="si">}</span> years old <span class="p">&lt;</span><span class="nt">br</span> <span class="p">/&gt;</span>
          So you were propably born <span class="si">{</span><span class="k">this</span><span class="p">.</span><span class="nx">bornYear</span><span class="p">()</span><span class="si">}</span> 
        <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Tässä tilanteessa ei kuitenkaan ole varsinaisesti mitään hyötyä määritellä apufunktiota <em>bornYear</em> metodiksi, joten parempi olisi määritellä se metodin <em>render</em> sisäisenä apumetodina:</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nx">Hello</span> <span class="kd">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">bornYear</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">yearNow</span> <span class="o">=</span> <span class="mi">1900</span> <span class="o">+</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">getYear</span><span class="p">()</span>
      <span class="k">return</span> <span class="nx">yearNow</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">age</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="p">(</span>
      <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>
          Hello <span class="si">{</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">name</span><span class="si">}</span>, you are <span class="si">{</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">age</span><span class="si">}</span> years old <span class="p">&lt;</span><span class="nt">br</span> <span class="p">/&gt;</span>
          So you were propably born <span class="si">{</span><span class="nx">bornYear</span><span class="p">()</span><span class="si">}</span> 
        <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Ennen kuin siirrymme eteenpäin, tarkastellaan erästä pientä, mutta käyttökelpoista ES6:n uutta piirrettä javascriptissä, eli sijoittamisen yhteydessä tapahtuvaa <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Destructuring_assignment">destruktorointia</a></p>

<p>Jouduimme äskeisessä koodissa viittaamaan propseina välitettyyn dataan hieman ikävästi muodossa <em>this.props.name</em> ja <em>this.props.age</em>. Näistä <em>this.props.age</em> pitää toistaa metodissa <em>render</em> kahteen kertaan.</p>

<p>Koska <em>this.props</em> on nyt olio</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">this</span><span class="p">.</span><span class="nx">props</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">name</span><span class="p">:</span> <span class="s1">'Arto Hellas'</span><span class="p">,</span>
  <span class="na">age</span><span class="p">:</span> <span class="mi">35</span>
<span class="p">}</span>
</code></pre></div></div>

<p>voisimme suoraviivaistaa metodia <em>render</em> siten, että sijoittaisimme kenttien arvot muuttujiin <em>name</em> ja <em>age</em> joita voisimme sitten hyödyntää</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">name</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">name</span>
    <span class="kd">const</span> <span class="nx">age</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">age</span>
    <span class="kd">const</span> <span class="nx">bornYear</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="mi">1900</span> <span class="o">+</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">getYear</span><span class="p">()</span> <span class="o">-</span> <span class="nx">age</span>

    <span class="k">return</span> <span class="p">(</span>
      <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span>
          <span class="nx">Hello</span> <span class="p">{</span><span class="nx">name</span><span class="p">},</span> <span class="nx">you</span> <span class="nx">are</span> <span class="p">{</span><span class="nx">age</span><span class="p">}</span> <span class="nx">years</span> <span class="nx">old</span> <span class="o">&lt;</span><span class="nx">br</span> <span class="o">/&gt;</span>
          <span class="nx">So</span> <span class="nx">you</span> <span class="nx">were</span> <span class="nx">propably</span> <span class="nx">born</span> <span class="p">{</span><span class="nx">bornYear</span><span class="p">()}</span> 
        <span class="o">&lt;</span><span class="sr">/p</span><span class="err">&gt;
</span>      <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>    <span class="p">)</span>
  <span class="p">}</span>
</code></pre></div></div>

<p>Huomaa, että oleme myös hyödyntäneet nuolifunktion kompaktimpaa kirjoitustapaa.</p>

<p>Destrukturointi tekee asian vielä helpommaksi, sen avulla voimme “kerätä” olion oliomuuttujien arvot suoraan omiin yksittäisiin muuttujiin:</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nx">Hello</span> <span class="kd">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="p">{</span><span class="nx">name</span><span class="p">,</span> <span class="nx">age</span><span class="p">}</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">props</span>
    <span class="kd">const</span> <span class="nx">bornYear</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="mi">1900</span> <span class="o">+</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">getYear</span><span class="p">()</span> <span class="o">-</span> <span class="nx">age</span>

    <span class="k">return</span> <span class="p">(</span>
      <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>
          Hello <span class="si">{</span><span class="nx">name</span><span class="si">}</span>, you are <span class="si">{</span><span class="nx">age</span><span class="si">}</span> years old <span class="p">&lt;</span><span class="nt">br</span> <span class="p">/&gt;</span>
          So you were propably born <span class="si">{</span><span class="nx">bornYear</span><span class="p">()</span><span class="si">}</span> 
        <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Eli koska</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">this</span><span class="p">.</span><span class="nx">props</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">name</span><span class="p">:</span> <span class="s1">'Arto Hellas'</span><span class="p">,</span>
  <span class="na">age</span><span class="p">:</span> <span class="mi">35</span>
<span class="p">}</span>
</code></pre></div></div>

<p>saa &lt;code const {name, age} = this.props&lt;/code&gt;&gt; aikaan sen, että <em>name</em> saa arvon ‘Arto Hellas’ ja <em>age</em> arvon 35.</p>

<p>Komponentti <em>Hello</em> on oikeastaan luonteeltaan sellainen, että sitä ei ole järkevää määritellä luokkasyntaksilla. Reactin best practice onkin käyttää funktioiden avulla määriteltyjä komponentteja aina kuin mahdollista.</p>

<h3 id="sivun-uudelleenrenderöinti">Sivun uudelleenrenderöinti</h3>

<p>Toistaiseksi tekemämme sovellukset ovat olleet sellaisia, että kun niiden komponentit on kerran renderöity, niiden tilaa ei ole enää voinut muuttaa. Entä jos haluaisimme toteuttaa laskurin, jonka arvo kasvaa esim. ajan kuluessa tai nappien painallusten yhteydessä?</p>

<p>Aloitetaan seuravasta rungosta:</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">App</span> <span class="o">=</span> <span class="p">(</span><span class="nx">props</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="p">{</span><span class="nx">counter</span><span class="p">}</span> <span class="o">=</span> <span class="nx">props</span>
  <span class="k">return</span><span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span><span class="si">{</span><span class="nx">counter</span><span class="p">.</span><span class="nx">value</span><span class="si">}</span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">)</span>
<span class="p">}</span> 

<span class="kd">const</span> <span class="nx">counter</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">value</span><span class="p">:</span> <span class="mi">1</span>
<span class="p">}</span>

<span class="nx">ReactDOM</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span>
  <span class="p">&lt;</span><span class="nc">App</span> <span class="na">counter=</span><span class="si">{</span><span class="nx">counter</span><span class="si">}</span> <span class="p">/&gt;,</span>
  <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">'root'</span><span class="p">)</span>
<span class="p">)</span>
</code></pre></div></div>

<p>Sovelluksen juurikomponentille siis annetaan viite laskuriin. Juurikomponentti renderöi arvon ruudulle. Entä laskurin arvon muuttuessa? Jos lisäämme ohjelmaan esim. komennon</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">counter</span><span class="p">.</span><span class="nx">value</span> <span class="o">+=</span> <span class="mi">1</span>
</code></pre></div></div>

<p>ei komponenttia kuitenkaan renderöidä uudelleen. Voimme saada komponentin uudelleenrenderöitymään kutsumalla uudelleen metodia <em>ReactDOM.render</em>, esim. seuraavasti</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">App</span> <span class="o">=</span> <span class="p">(</span><span class="nx">props</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="p">{</span><span class="nx">counter</span><span class="p">}</span> <span class="o">=</span> <span class="nx">props</span>
  <span class="k">return</span><span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span><span class="si">{</span><span class="nx">counter</span><span class="p">.</span><span class="nx">value</span><span class="si">}</span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">)</span>
<span class="p">}</span> 

<span class="kd">const</span> <span class="nx">counter</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">value</span><span class="p">:</span> <span class="mi">1</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">renderoi</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">ReactDOM</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span>
    <span class="p">&lt;</span><span class="nc">App</span> <span class="na">counter=</span><span class="si">{</span><span class="nx">counter</span><span class="si">}</span> <span class="p">/&gt;,</span>
    <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">'root'</span><span class="p">)</span>
  <span class="p">)</span>
<span class="p">}</span>

<span class="nx">renderoi</span><span class="p">()</span>
<span class="nx">counter</span><span class="p">.</span><span class="nx">value</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="nx">renderoi</span><span class="p">()</span>
<span class="nx">counter</span><span class="p">.</span><span class="nx">value</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="nx">renderoi</span><span class="p">()</span>
</code></pre></div></div>

<p>Copypastea vähentämään on komponentin renderöinti kääritty funktioon <em>renderoi</em>.</p>

<p>Nyt komponentti renderöityy kolme kertaa, saaden ensin arvon 1, sitten 2 ja lopulta 3. 1 ja 2 tosin ovat ruudulla niin vähän aikaa, että niitä ei ehdi havaita.</p>

<p>Hieman mielenkiintoisempaan toiminnallisuuteen pääsemme tekemällä renderöinnin ja laskurin kasvatuksen toistuvasti sekunnin välein käyttäen <a href="https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/setInterval">SetInterval</a>-</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">setInterval</span><span class="p">(</span>
  <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span> 
    <span class="nx">renderoi</span><span class="p">()</span>
    <span class="nx">counter</span><span class="p">.</span><span class="nx">value</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
</code></pre></div></div>

<p><em>ReactDOM.render</em>-metodin toistuva kutsuminen ei kuitenkaan ole suositeltu tapa päivittää komponentteja. Tutustutaan seuraavaksi järkevämpään tapaan.</p>

<h3 id="tilallinen-komponentti">tilallinen komponentti</h3>

<p>Muutetaan esimerkkisovelluksen komponentti <em>App</em> luokkaperustaiseksi:</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nx">App</span>  <span class="kd">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
  <span class="kd">constructor</span><span class="p">(</span><span class="nx">props</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">super</span><span class="p">(</span><span class="nx">props</span><span class="p">)</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">state</span> <span class="o">=</span> <span class="p">{</span>
      <span class="na">counter</span><span class="p">:</span> <span class="mi">1</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span>
      <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span><span class="si">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">counter</span><span class="si">}</span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span> 

<span class="nx">ReactDOM</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span>
  <span class="p">&lt;</span><span class="nc">App</span> <span class="p">/&gt;,</span>
  <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">'root'</span><span class="p">)</span>
<span class="p">)</span> 
</code></pre></div></div>

<p>Komponentilla on nyt metodin <em>render</em> lisäksi <em>konstruktori</em>. Komponentin konstruktori saa parametrikseen sille välitettävät muuttujat parametrin <em>props</em> välityksellä, konstruktorin ensimmäisen rivin on oltava kutsu <code>super(props)</code>.</p>

<p>Luokkiin perustuvalla komponenteilla voi olla <em>tila</em>, joka talletetaan muuttujaan <em>state</em>.</p>

<p>Konstruktori määrittelee komponentin alkutilan olevan:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span>
  <span class="nl">counter</span><span class="p">:</span> <span class="mi">1</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Eli tila sisältää kentän <em>counter</em>, jonka arvo on 1. React-komponettien tilaa, eli muuttujaa <em>this.state</em> <strong>ei saa päivittää suoraan</strong>, tilan päivitys on tehtävä aina funktion <a href="https://reactjs.org/docs/faq-state.html#what-does-setstate-do">setState</a> avulla. Metodin kutsuminen päivittää tilan <em>ja</em> aiheuttaa komponentin uuden renderöinnin. Uudelleenrenderöinnin yhteydessä myös kaikki komponentin sisältämät alikomponentit renderöidään.</p>

<p>Muutetaan komponenttia <em>App</em> siten, että konstruktorissa käynnistetään ajastin joka kutsuu funktiota <em>setState</em> kolmen sekunnin kuluttua ja asettaa laskurin, eli <em>this.state.counter</em>:in arvoksi 1000.</p>

<pre><code class="language-render">class App  extends React.Component {
  constructor() {
    super()
    this.state = {
      counter: 1
    }

    setTimeout(() =&gt; {
      this.setState({counter: 1000})
    }, 3000);
  }
  render() {
    return (
      &lt;div&gt;{this.state.counter}&lt;/div&gt;
    )
  }
} 
</code></pre>

<p>Tehdään sovelluksesta vielä edistyneempi versio, missä metodia <em>setState</em> kutsutaan toistuvasti sekunnin välein päivittäen laskurin arvoa aina yhdellä.</p>

<pre><code class="language-render">class App  extends React.Component {
  constructor() {
    super()
    this.state = {
      counter: 1
    }

    setInterval(() =&gt; {
      this.setState({ counter: this.state.counter + 1 })
    }, 1000);
  }
  render() {
    return (
      &lt;div&gt;{this.state.counter}&lt;/div&gt;
    )
  }
} 
</code></pre>

<h3 id="tapahtumankäsittely">tapahtumankäsittely</h3>

<p>Mainitsimme jo alun johdanto-osassa muutamaan kertaan <em>tepahtumankäsittelijät</em>, eli funktiot, jotka on rekisteröity kutsuttavaksi tiettyjen tapahtumien eli eventien yhteydessä. Esim. käyttäjän interaktio sivun elementtien kanssa aiheuttaa joukon erinäisiä tapahtumia.</p>

<p>Muutetaan sovellusta siten, että laskurin kasvaminen tapahtuukin käyttäjän painaessa <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/button">button</a>-elementin avulla toteutettua nappia.</p>

<p>Button-elementit tukevat mm. <a href="https://developer.mozilla.org/en-US/docs/Web/API/MouseEvent">hiiritapahtumia</a>, joista yleisin on <a href="https://developer.mozilla.org/en-US/docs/Web/Events/click">click</a>.</p>

<p>Reactissa funktion rekisteröiminen tapahtumankäsittelijäksi <a href="https://reactjs.org/docs/handling-events.html">tapahtuu</a> tapahtumalle <em>click</em> tapahtuu seuraavasti:</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">funktio</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="cm">/* koodi */</span> <span class="p">}</span>

<span class="c1">//...</span>

<span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick=</span><span class="si">{</span><span class="nx">funktio</span><span class="si">}</span><span class="p">&gt;</span>
  plus
<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
</code></pre></div></div>
<p>Tapahtumankäsittelijäfunktio voidaan myös määritellä suoraan onClick-määrittelyn yhteydessä:</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nx">App</span>  <span class="kd">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
  <span class="kd">constructor</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">super</span><span class="p">()</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">state</span> <span class="o">=</span> <span class="p">{</span>
      <span class="na">counter</span><span class="p">:</span> <span class="mi">1</span>
    <span class="p">}</span>

  <span class="p">}</span>
  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span>
      <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span><span class="si">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">counter</span><span class="si">}</span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick=</span><span class="si">{</span><span class="p">()</span><span class="o">=&gt;</span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'clicked'</span><span class="p">)</span><span class="si">}</span><span class="p">&gt;</span>
          plus
        <span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span> 
</code></pre></div></div>

<p>Nyt jokainen napin <em>plus</em> painallus tulostaa konsoliin <em>clicked</em>.</p>

<p>Muuttamalla tapahtumankäsittelijä seuraavaan muotoon</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="o">&lt;</span><span class="nx">button</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{()</span><span class="o">=&gt;</span><span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span> <span class="na">counter</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">counter</span><span class="o">+</span><span class="mi">1</span> <span class="p">})</span> <span class="p">}</span><span class="o">&gt;</span>
      <span class="nx">plus</span>
    <span class="o">&lt;</span><span class="sr">/button</span><span class="err">&gt;
</span></code></pre></div></div>

<p>saamme halutun toiminnallisuuden.</p>

<p>Lisätään sovellukseen myös nappi laskurin nollaamiseen:</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nx">App</span>  <span class="kd">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
  <span class="kd">constructor</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">super</span><span class="p">()</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">state</span> <span class="o">=</span> <span class="p">{</span>
      <span class="na">counter</span><span class="p">:</span> <span class="mi">1</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span>
      <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span><span class="si">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">counter</span><span class="si">}</span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick=</span><span class="si">{</span><span class="p">()</span> <span class="o">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span> <span class="na">counter</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">counter</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">})</span><span class="si">}</span><span class="p">&gt;</span>
            plus
          <span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick=</span><span class="si">{</span><span class="p">()</span> <span class="o">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span> <span class="na">counter</span><span class="p">:</span> <span class="mi">0</span> <span class="p">})</span><span class="si">}</span><span class="p">&gt;</span>
            zero
          <span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>          
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nx">Sovelluksemme</span> <span class="nx">on</span> <span class="nx">valmis</span><span class="o">!</span>

<span class="err">###</span> <span class="nx">metodien</span> <span class="nx">k</span><span class="err">ä</span><span class="nx">ytt</span><span class="err">ö</span> <span class="nx">ja</span> <span class="nx">_this_</span>

<span class="nx">Tapahtumank</span><span class="err">ä</span><span class="nx">sittelij</span><span class="err">ö</span><span class="nx">iden</span> <span class="nx">m</span><span class="err">ää</span><span class="nx">rittely</span> <span class="nx">suoraan</span> <span class="nx">JSX</span><span class="o">-</span><span class="nx">templatejen</span> <span class="nx">_return_</span><span class="o">-</span><span class="nx">lauseiden</span> <span class="nx">sis</span><span class="err">ä</span><span class="nx">ll</span><span class="err">ä</span> <span class="nx">ei</span> <span class="nx">ole</span> <span class="nx">yleens</span><span class="err">ä</span> <span class="nx">kovin</span> <span class="nx">visasta</span><span class="p">.</span> <span class="nx">Eriytet</span><span class="err">ää</span><span class="nx">n</span> <span class="nx">nappien</span> <span class="nx">tapahtumank</span><span class="err">ä</span><span class="nx">sittelij</span><span class="err">ä</span> <span class="nx">omaksi</span> <span class="nx">metodeikseen</span><span class="p">:</span> 

<span class="s2">```react
class App  extends React.Component {
  constructor() {
    super()
    this.state = {
      counter: 1
    }
  }

  kasvataYhdella() {
    this.setState({ counter: this.state.counter+1 })
  }

  nollaa() {
    this.setState({ counter: 0 })  
  }

  render() {
    return (
      &lt;div&gt;
        &lt;div&gt;{this.state.counter}&lt;/div&gt;
        &lt;div&gt;
          &lt;button onClick={this.kasvataYhdella}&gt;
            plus
          &lt;/button&gt;
          &lt;button onClick={this.nollaa}&gt;
            zero
          &lt;/button&gt;          
        &lt;/div&gt;
      &lt;/div&gt;
    )
  }
} 
</span></code></pre></div></div>

<p>Komponentin määrittelemälle luokalle on nyt lisätty metodit <em>kasvataYhdella</em> ja <em>nollaa</em>. Metodeihin <em>viitataan</em> nappeja vastaavista React-elementeistä:</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&lt;</span><span class="nx">button</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">kasvataYhdella</span><span class="p">}</span><span class="o">&gt;</span>
</code></pre></div></div>

<p>Kun testaamme nyt sovellusta, törmäämme ongelmaan. Virheilmoitus on erittäin hyvä:</p>

<p><img src="http://localhost:4000/assets/1/29.png" alt="" /></p>

<p>Eli törmäämme Javascriptin luokkien yhteydessä mainitsemaamme ongelmaan alkuperäisen <em>this</em>:in kadottamisesta.</p>

<p>Kun javascriptin runtime kutsuu takaisinkutsufunktiota, <em>this</em> ei enää viittaa komponenttiin <em>App</em> vaan on arvoltaan <em>undefined</em> eli määrittelemätön:</p>

<p><img src="http://localhost:4000/assets/1/6.png" alt="" /></p>

<p>Ongelmaan on useita erilaisia ratkaisuja. Eräs näistä on aiemminkin mainitsemamme <em>bindaaminen</em>, eli esim. komennolla <code>this.kasvataYhdella.bind(this)</code> voimme muodostaa uuden funktion, jonka koodi on alkuperäisen funktion koodi missä <em>this</em> on sidottu viittaamaan parametrina olevaan arvoon, eli komponenttiin itseensä. Eli sovellus toimii taas kun koodi muotetaan muotoon:</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="o">&lt;</span><span class="nx">button</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">kasvataYhdella</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">)}</span><span class="o">&gt;</span>
      <span class="nx">plus</span>
    <span class="o">&lt;</span><span class="sr">/button</span><span class="err">&gt;
</span>    <span class="o">&lt;</span><span class="nx">button</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">nollaa</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">)}</span><span class="o">&gt;</span>
      <span class="nx">zero</span>
    <span class="o">&lt;</span><span class="sr">/button&gt; </span><span class="err"> 
</span></code></pre></div></div>

<p>Jos samaa metodia joudutaan kutsumaan useasta kohtaa koodia, on hieman ikävää kirjoittaa toistuvasti metodin bindattu muoto React-elementtien sekaan.</p>

<p>Yksi mahdollisuus onkin suorittaa bindaukset konstruktorissa:</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nx">App</span>  <span class="kd">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
  <span class="kd">constructor</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">super</span><span class="p">()</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">state</span> <span class="o">=</span> <span class="p">{</span>
      <span class="na">counter</span><span class="p">:</span> <span class="mi">1</span>
    <span class="p">}</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">kasvataYhdella</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">kasvataYhdella</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">nollaa</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">nollaa</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>
  <span class="p">}</span>
</code></pre></div></div>

<p>Nyt riittää viitata metodeihin “normaalisti”, ilman bindiä:</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="o">&lt;</span><span class="nx">button</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">kasvataYhdella</span><span class="p">}</span><span class="o">&gt;</span>
      <span class="nx">plus</span>
    <span class="o">&lt;</span><span class="sr">/button</span><span class="err">&gt;
</span>    <span class="o">&lt;</span><span class="nx">button</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">nollaa</span><span class="p">}</span><span class="o">&gt;</span>
      <span class="nx">zero</span>
    <span class="o">&lt;</span><span class="sr">/button&gt; </span><span class="err"> 
</span></code></pre></div></div>

<p>Tenkisesti ottaen konstruktorissa korvataan kenttään <em>kasvataYhdella</em> alunperin määritelty metodi uudella metodilla, jolla on alkuperäisen oodi siten, että <em>this</em> on pysyväti bindattu olioon itseensä.</p>

<p>paras käyttää vielä standardoimatonta <a href="https://babeljs.io/docs/plugins/transform-class-properties/">class properties</a> -featurea</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nx">kasvataYhdella</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span> <span class="na">counter</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">counter</span><span class="o">+</span><span class="mi">1</span> <span class="p">})</span>
  <span class="p">}</span>

  <span class="nx">nollaa</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span> <span class="na">counter</span><span class="p">:</span> <span class="mi">0</span> <span class="p">})</span>  
  <span class="p">}</span>
</code></pre></div></div>

<h3 id="huomio-funktion-setstate-käytöstä">huomio funktion setState käytöstä</h3>

<p>älä kutsu noin…</p>

<h3 id="refaktorointi">refaktorointi</h3>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="nx">asetaArvoon</span> <span class="o">=</span> <span class="p">(</span><span class="nx">arvo</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span> <span class="na">counter</span><span class="p">:</span> <span class="nx">arvo</span> <span class="p">})</span>  
    <span class="p">}</span>

    <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick=</span><span class="si">{</span><span class="k">this</span><span class="p">.</span><span class="nx">asetaArvoon</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">counter</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="si">}</span><span class="p">&gt;</span>
      Plus
    <span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>    
<span class="s2">```react

funktio joka palauttaa funktion...

```</span><span class="nx">react</span>
<span class="kd">class</span> <span class="nx">App</span>  <span class="kd">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
  <span class="kd">constructor</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">super</span><span class="p">()</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">state</span> <span class="o">=</span> <span class="p">{</span>
      <span class="na">counter</span><span class="p">:</span> <span class="mi">1</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="nx">asetaArvoon</span> <span class="o">=</span> <span class="p">(</span><span class="nx">arvo</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span> 
    <span class="k">return</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span> <span class="na">counter</span><span class="p">:</span> <span class="nx">arvo</span> <span class="p">})</span>  
    <span class="p">}</span>
  <span class="p">}</span> 

  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span>
      <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span><span class="si">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">counter</span><span class="si">}</span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick=</span><span class="si">{</span><span class="k">this</span><span class="p">.</span><span class="nx">asetaArvoon</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">counter</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="si">}</span><span class="p">&gt;</span>
            Plus
          <span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>        
          <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick=</span><span class="si">{</span><span class="k">this</span><span class="p">.</span><span class="nx">asetaArvoon</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="si">}</span><span class="p">&gt;</span>
            Zero
          <span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>   
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span> 
<span class="s2">```react

suoraviivastus

```</span><span class="nx">react</span>
  <span class="nx">asetaArvoon</span> <span class="o">=</span> <span class="p">(</span><span class="nx">arvo</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span> <span class="na">counter</span><span class="p">:</span> <span class="nx">arvo</span> <span class="p">})</span>  
</code></pre></div></div>

<h3 id="tilan-vienti-alikomponenttiin">tilan vienti alikomponenttiin</h3>

<h3 id="debuggaus">debuggaus</h3>

<ul>
  <li>konsoli auki AINA</li>
  <li>console.log</li>
  <li>komento debug</li>
  <li>debuggeri</li>
  <li>react dev tool</li>
</ul>

<h3 id="hyödyllistä-materiaalia">hyödyllistä materiaalia</h3>

<h3 id="react-tehtävät-osa-2">react-tehtävät, osa 2</h3>

  </div>

</article>

      </div>
    </main>

    <footer class="site-footer">

  <div class="wrapper">

    <h2 class="footer-heading">Full stack -websovelluskehitys</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li>
             Full stack -websovelluskehitys 
          </li>
          
          <li>
            <a href="mailto:mluukkai@iki.fi">mluukkai@iki.fi</a>
          </li>
          <li>
            <a href="https://courses.helsinki.fi/fi/TKT21009/121540749">https://courses.helsinki.fi/fi/TKT21009/121540749</a>
          </li>
          
        </ul>
      </div>

      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/mluukkai"><span class="icon icon--github"><svg viewBox="0 0 16 16" width="16px" height="16px"><path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/></svg>
</span><span class="username">mluukkai</span></a>

          </li>
           
        </ul>
      </div>

      <div class="footer-col footer-col-3">
        <p></p>
      </div>
    </div>

  </div>

</footer>

  </body>

</html>
